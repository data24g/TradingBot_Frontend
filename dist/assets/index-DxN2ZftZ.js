import{r as s,u as Le,a as Re,j as e,N as Ge,L as me,b as Se,c as ot,O as it,d as ct,F as Ve,e as qe,f as Ye,g as _e,h as dt,i as Xe,k as xt,l as Je,m as mt,n as ut,o as gt,p as ht,q as pt,s as bt,t as ft,v as yt,w as jt,x as Nt,y as vt,z as wt,A as St,H as Ct,R as kt,B as ae,C as Lt,D as Dt}from"./react-vendor-DVqyRRmc.js";import{a as $}from"./axios-vendor-B9ygI19o.js";import{V as Fe,a as At,I as Ie,d as pe}from"./vendor-ck566IHf.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const p of o)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function h(o){const p={};return o.integrity&&(p.integrity=o.integrity),o.referrerPolicy&&(p.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?p.credentials="include":o.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(o){if(o.ep)return;o.ep=!0;const p=h(o);fetch(o.href,p)}})();const Ze=s.createContext(void 0),Tt=({children:t})=>{const n=Le(),h=Re(),[d,o]=s.useState(()=>localStorage.getItem("token")),p=!!d;s.useEffect(()=>{const l=localStorage.getItem("token");o(l)},[h.pathname]);const m=()=>{localStorage.removeItem("token"),o(null),n("/login")};return e.jsx(Ze.Provider,{value:{isAuthenticated:p,logout:m},children:t})},Qe=()=>{const t=s.useContext(Ze);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},Pt=({children:t})=>{const{isAuthenticated:n}=Qe();return n?t:e.jsx(Ge,{to:"/login",replace:!0})},Et=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),Ft=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),e.jsx("path",{d:"M12 8v4l2 2"})]}),Te=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})}),It=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),Ue=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"12",x2:"12",y1:"20",y2:"10"}),e.jsx("line",{x1:"18",x2:"18",y1:"20",y2:"4"}),e.jsx("line",{x1:"6",x2:"6",y1:"20",y2:"16"})]}),Mt=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),Rt=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),$e=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Ut=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),Be=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]}),Ot=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z"}),e.jsx("path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"}),e.jsx("path",{d:"M12 2v2"}),e.jsx("path",{d:"M12 22v-2"}),e.jsx("path",{d:"m17 20.66-1-1.73"}),e.jsx("path",{d:"M11 10.27 7 3.34"}),e.jsx("path",{d:"m22 12-2 0"}),e.jsx("path",{d:"M4 12H2"}),e.jsx("path",{d:"m20.66 7-1.73-1"}),e.jsx("path",{d:"m3.34 7 1.73 1"}),e.jsx("path",{d:"m14 12 7.32-4.24"}),e.jsx("path",{d:"m7 20.66 1-1.73"}),e.jsx("path",{d:"M3.34 17 7 13.73"})]}),$t=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),e.jsx("polyline",{points:"12 19 5 12 12 5"})]}),Bt=()=>{const[t,n]=s.useState(""),[h,d]=s.useState(""),[o,p]=s.useState(""),[m,l]=s.useState(!1),c=Le(),a=async y=>{var u,i;y.preventDefault(),p(""),l(!0);try{const N=await $.post("https://api.binancebotpro.com/api/auth/login",{identifier:t,password:h});if(N.data&&N.data.token){const{token:v}=N.data;localStorage.setItem("token",v),c("/")}else p("Phản hồi từ server không hợp lệ (thiếu token).")}catch(N){if(console.error("Login error:",N),N.response){const v=((u=N.response.data)==null?void 0:u.message)||((i=N.response.data)==null?void 0:i.error);p(v||"Thông tin đăng nhập không chính xác.")}else N.request?p("Không thể kết nối đến server. Vui lòng kiểm tra mạng."):p("Đã xảy ra lỗi. Vui lòng thử lại.")}finally{l(!1)}};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md p-8 space-y-8 bg-gray-800 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Ue,{className:"h-12 w-12 text-accent-yellow mb-2"}),e.jsx("h2",{className:"text-3xl font-bold text-center text-white",children:"TradingBot Dashboard"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-400",children:"Sign in to your account"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:a,children:[e.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[e.jsx("div",{children:e.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-accent-yellow focus:border-accent-yellow focus:z-10 sm:text-sm rounded-t-md",placeholder:"Email address (admin@gmail.com)",value:t,onChange:y=>n(y.target.value),disabled:m})}),e.jsx("div",{children:e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-accent-yellow focus:border-accent-yellow focus:z-10 sm:text-sm rounded-b-md",placeholder:"Password",value:h,onChange:y=>d(y.target.value),disabled:m})})]}),o&&e.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded p-2",children:e.jsx("p",{className:"text-sm text-red-400 text-center",children:o})}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-semibold rounded-md text-gray-900 bg-accent-yellow hover:bg-accent-yellow-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-yellow focus:ring-offset-gray-800 transition-colors disabled:bg-accent-yellow/50 disabled:cursor-not-allowed",disabled:m,children:m?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-900",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign in"})}),e.jsxs("div",{className:"text-sm text-center",children:[e.jsx("span",{className:"text-gray-400",children:"Don't have an account? "}),e.jsx(me,{to:"/register",className:"font-medium text-accent-yellow hover:text-accent-yellow-dark",children:"Register here"})]})]})]})})},Kt=({isOpen:t,onClose:n,onConfirm:h,title:d,children:o,confirmText:p="Confirm",cancelText:m="Cancel"})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b border-gray-700",children:e.jsx("h3",{className:"text-xl font-semibold text-white",children:d})}),e.jsx("div",{className:"p-6 text-gray-400",children:o}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 bg-gray-900/50 rounded-b-lg",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 rounded-md bg-gray-600 text-white font-semibold hover:bg-gray-500 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-800",children:m}),e.jsx("button",{onClick:h,className:"px-4 py-2 rounded-md bg-accent-yellow text-gray-900 font-semibold hover:bg-accent-yellow-dark transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-yellow focus:ring-offset-gray-800",children:p})]})]})}):null,zt=({isOpen:t,setIsOpen:n})=>{const{logout:h}=Qe(),d=Re(),o=Le(),[p,m]=s.useState(!1),[l,c]=s.useState(!1);s.useEffect(()=>{t&&n(!1)},[d.pathname]),s.useEffect(()=>{d.pathname==="/dca"&&c(!0)},[d.pathname]);const a=()=>{m(!0)},y=()=>{h(),m(!1)},u=({isActive:i})=>`flex items-center p-3 my-1 rounded-lg transition-colors ${i?"bg-accent-yellow text-gray-900 font-semibold":"text-gray-400 hover:bg-gray-700 hover:text-white"}`;return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:`w-64 bg-gray-800 p-4 flex flex-col h-screen fixed z-30 transition-transform transform ${t?"translate-x-0":"-translate-x-full"} md:translate-x-0`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"hidden md:flex items-center",children:[e.jsx(Ue,{className:"h-8 w-8 text-accent-yellow mr-2"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"TradingBot"})]}),e.jsx("div",{className:"md:hidden"}),e.jsx("button",{onClick:()=>n(!1),className:"md:hidden text-gray-400 hover:text-white","aria-label":"Close sidebar",children:e.jsx(Rt,{className:"w-6 h-6"})})]}),e.jsxs("nav",{className:"flex-grow",children:[e.jsxs(Se,{to:"/monitor",className:u,children:[e.jsx(Te,{className:"w-5 h-5 mr-3"}),"Theo dõi thị trường và giao dịch"]}),e.jsxs(Se,{to:"/strategy",className:u,children:[e.jsx(Te,{className:"w-5 h-5 mr-3"}),"Chiến lược đánh Future"]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{d.pathname==="/dca"?c(!l):(o("/dca?tab=REAL"),c(!0))},className:`w-full flex items-center p-3 my-1 rounded-lg transition-colors ${d.pathname==="/dca"?"bg-accent-yellow text-gray-900 font-semibold":"text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[e.jsx(Te,{className:"w-5 h-5 mr-3"}),"Đầu tư dài hạn DCA"]}),l&&d.pathname==="/dca"&&e.jsxs("div",{className:"ml-8 mt-1 space-y-1",children:[e.jsx("button",{onClick:()=>{o("/dca?tab=REAL"),n(!1)},className:`w-full flex items-center p-2 text-xs rounded-lg transition-colors ${d.search.includes("tab=REAL")||!d.search?"bg-green-600/20 text-green-400 font-semibold border-l-2 border-green-400":"text-gray-500 hover:bg-gray-700/50 hover:text-gray-300"}`,children:"Plan REAL"}),e.jsx("button",{onClick:()=>{o("/dca?tab=BACKTEST"),n(!1)},className:`w-full flex items-center p-2 text-xs rounded-lg transition-colors ${d.search.includes("tab=BACKTEST")?"bg-yellow-600/20 text-accent-yellow font-semibold border-l-2 border-accent-yellow":"text-gray-500 hover:bg-gray-700/50 hover:text-gray-300"}`,children:"Backtest"})]})]}),e.jsxs(Se,{to:"/users",className:u,children:[e.jsx(Et,{className:"w-5 h-5 mr-3"}),"Quản lý người dùng"]}),e.jsxs(Se,{to:"/history",className:u,children:[e.jsx(Ft,{className:"w-5 h-5 mr-3"}),"Lịch sử giao dịch"]})]}),e.jsx("div",{children:e.jsxs("button",{onClick:a,className:"flex items-center w-full p-3 rounded-lg text-gray-400 hover:bg-red-500/20 hover:text-accent-red transition-colors",children:[e.jsx(It,{className:"w-5 h-5 mr-3"}),"Logout"]})})]}),e.jsx(Kt,{isOpen:p,onClose:()=>m(!1),onConfirm:y,title:"Confirm Logout",children:e.jsx("p",{children:"Are you sure you want to log out of the system?"})})]})},Ht=({isOpen:t,onClose:n,onUserAdded:h})=>{const[d,o]=s.useState(""),[p,m]=s.useState(""),[l,c]=s.useState(""),[a,y]=s.useState(!1),[u,i]=s.useState(""),N=()=>{o(""),m(""),c(""),i(""),y(!1)},v=()=>{N(),n()},E=async D=>{if(D.preventDefault(),!d||!p||!l){i("All fields are required.");return}i(""),y(!0);try{const k=await $.post("https://api.binancebotpro.com/api/users",{username:d,apiKey:p,apiSecret:l}),A={id:k.data.id,username:k.data.username,isActive:k.data.tradingConfig.active,tradesToday:k.data.tradesToday,lastTradeDate:k.data.lastTradeDate};h(A),v()}catch(k){console.error("Failed to create user:",k),$.isAxiosError(k)&&k.response?i(`Failed to create user: ${k.response.data.message||k.message}`):i("An unexpected error occurred.")}finally{y(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:v,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:D=>D.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b border-gray-700",children:e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Add New User"})}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),e.jsx("input",{id:"username",type:"text",value:d,onChange:D=>o(D.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow text-white",required:!0,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-300 mb-1",children:"API Key"}),e.jsx("input",{id:"apiKey",type:"password",value:p,onChange:D=>m(D.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow text-white",required:!0,autoComplete:"new-password",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apiSecret",className:"block text-sm font-medium text-gray-300 mb-1",children:"API Secret"}),e.jsx("input",{id:"apiSecret",type:"password",value:l,onChange:D=>c(D.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow text-white",required:!0,autoComplete:"new-password",disabled:a})]}),u&&e.jsx("p",{className:"text-sm text-accent-red",children:u})]}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 bg-gray-900/50 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 rounded-md bg-gray-600 text-white font-semibold hover:bg-gray-500 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-800",disabled:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-accent-yellow text-gray-900 font-semibold hover:bg-accent-yellow-dark transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-yellow focus:ring-offset-gray-800 disabled:bg-accent-yellow/50 disabled:cursor-not-allowed",disabled:a,children:a?"Creating...":"Create User"})]})]})]})}):null},Wt=t=>{var n;if(t.startsWith("/monitor/"))return`${((n=t.split("/").pop())==null?void 0:n.replace("USDT",""))||"Chart"} Chart`;switch(t){case"/users":return"User Management";case"/history":return"Trade History";case"/monitor":return"Coin Monitor";default:return"Dashboard"}},Gt=()=>ot(),Vt=()=>{const[t,n]=s.useState(!1),h=Re(),[d,o]=s.useState(!1),[p,m]=s.useState([]),l=s.useMemo(()=>Wt(h.pathname),[h.pathname]),c=y=>{m(u=>[...u,y].sort((i,N)=>i.username.localeCompare(N.username)))},a=()=>{window.location.reload()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-900 text-gray-200",children:[t&&e.jsx("div",{className:"fixed inset-0 bg-black opacity-50 z-20 md:hidden",onClick:()=>n(!1)}),e.jsx(zt,{isOpen:t,setIsOpen:n}),e.jsxs("div",{className:"flex flex-col md:ml-64",children:[e.jsxs("header",{className:"md:hidden bg-accent-yellow p-4 grid grid-cols-3 items-center sticky top-0 z-10 border-b border-gray-900/20 shadow-md",children:[e.jsx("div",{className:"justify-self-start",children:e.jsx("button",{onClick:()=>n(!0),"aria-label":"Open sidebar",className:"text-gray-800 hover:text-black p-2 rounded-full hover:bg-black/10 transition-colors",children:e.jsx(Mt,{className:"w-6 h-6"})})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900 text-center justify-self-center whitespace-nowrap",children:l}),e.jsxs("div",{className:"flex items-center gap-1 justify-self-end",children:[e.jsx("button",{onClick:a,className:"p-2 rounded-full text-gray-800 hover:bg-black/10 transition-colors",title:"Refresh page data",children:e.jsx(Be,{className:"w-5 h-5"})}),h.pathname==="/users"&&e.jsx("button",{onClick:()=>o(!0),className:"p-2 rounded-full text-gray-800 hover:bg-black/10 transition-colors",title:"Add User",children:e.jsx($e,{className:"w-5 h-5"})})]})]}),e.jsxs("header",{className:"hidden md:flex bg-gray-800 border-b border-gray-700 h-20 items-center justify-between px-10 sticky top-0 z-10",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:l}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:a,className:"p-2 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors",title:"Refresh page data",children:e.jsx(Be,{className:"w-5 h-5"})}),h.pathname==="/users"&&e.jsxs("button",{onClick:()=>o(!0),className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-gray-900 bg-accent-yellow hover:bg-accent-yellow-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-yellow focus:ring-offset-gray-800 transition-colors",children:[e.jsx($e,{className:"w-5 h-5 mr-2 -ml-1"}),"Add User"]})]})]}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-10 overflow-y-auto",children:e.jsx(it,{context:{users:p,setUsers:m,handleUserAdded:c}})})]})]}),e.jsx(Ht,{isOpen:d,onClose:()=>o(!1),onUserAdded:c})]})},qt=({isOpen:t,onClose:n,user:h})=>{const[d,o]=s.useState(""),[p,m]=s.useState(""),[l,c]=s.useState(!1),[a,y]=s.useState(""),[u,i]=s.useState(""),N=()=>{o(""),m(""),y(""),i(""),c(!1)},v=()=>{N(),n()},E=async D=>{if(D.preventDefault(),!d||!p){y("Both API Key and Secret are required.");return}y(""),i(""),c(!0);try{await $.put(`https://api.binancebotpro.com/api/users/${h.id}/credentials`,{newApiKey:d,newApiSecret:p}),i("Credentials updated successfully!"),setTimeout(()=>{v()},1500)}catch(k){console.error("Failed to update credentials:",k),$.isAxiosError(k)&&k.response?y(`Update failed: ${k.response.data.message||k.message}`):y("An unexpected error occurred.")}finally{c(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:v,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:D=>D.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b border-gray-700",children:e.jsxs("h3",{className:"text-xl font-semibold text-white",children:["Edit Credentials for ",e.jsx("span",{className:"text-accent-yellow",children:h.username})]})}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newApiKey",className:"block text-sm font-medium text-gray-300 mb-1",children:"New API Key"}),e.jsx("input",{id:"newApiKey",type:"password",value:d,onChange:D=>o(D.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow text-white",required:!0,autoComplete:"new-password",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newApiSecret",className:"block text-sm font-medium text-gray-300 mb-1",children:"New API Secret"}),e.jsx("input",{id:"newApiSecret",type:"password",value:p,onChange:D=>m(D.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow text-white",required:!0,autoComplete:"new-password",disabled:l})]}),a&&e.jsx("p",{className:"text-sm text-accent-red",children:a}),u&&e.jsx("p",{className:"text-sm text-accent-green",children:u})]}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 bg-gray-900/50 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 rounded-md bg-gray-600 text-white font-semibold hover:bg-gray-500 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-800",disabled:l,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-accent-yellow text-gray-900 font-semibold hover:bg-accent-yellow-dark transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-yellow focus:ring-offset-gray-800 disabled:bg-accent-yellow/50 disabled:cursor-not-allowed",disabled:l,children:l?"Updating...":"Update Credentials"})]})]})]})}):null},Yt=({isOpen:t,onClose:n,user:h,onConfigUpdated:d})=>{const[o,p]=s.useState(""),[m,l]=s.useState(!1),[c,a]=s.useState(""),[y,u]=s.useState("");s.useEffect(()=>{var E;h&&p(((E=h.orderSizeUSD)==null?void 0:E.toString())||"")},[h]);const i=()=>{a(""),u(""),l(!1)},N=()=>{i(),n()},v=async E=>{E.preventDefault();const D=Number(o);if(isNaN(D)||D<=0){a("Please enter a valid, positive number for the order size.");return}a(""),u(""),l(!0);try{await $.put(`https://api.binancebotpro.com/api/users/${h.id}/config`,{orderSizeUSD:D}),d({...h,orderSizeUSD:D}),u("Configuration updated successfully!"),setTimeout(()=>{N()},1500)}catch(k){console.error("Failed to update config:",k),$.isAxiosError(k)&&k.response?a(`Update failed: ${k.response.data.message||k.message}`):a("An unexpected error occurred.")}finally{l(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:N,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:E=>E.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b border-gray-700",children:e.jsxs("h3",{className:"text-xl font-semibold text-white",children:["Configure Order Size for ",e.jsx("span",{className:"text-accent-yellow",children:h.username})]})}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"orderSize",className:"block text-sm font-medium text-gray-300 mb-1",children:"Order Size (USD)"}),e.jsx("input",{id:"orderSize",type:"number",value:o,onChange:E=>p(E.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow text-white",required:!0,placeholder:"e.g., 1000",min:"0",step:"any",disabled:m})]}),c&&e.jsx("p",{className:"text-sm text-accent-red",children:c}),y&&e.jsx("p",{className:"text-sm text-accent-green",children:y})]}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 bg-gray-900/50 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 rounded-md bg-gray-600 text-white font-semibold hover:bg-gray-500 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-800",disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-accent-yellow text-gray-900 font-semibold hover:bg-accent-yellow-dark transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-yellow focus:ring-offset-gray-800 disabled:bg-accent-yellow/50 disabled:cursor-not-allowed",disabled:m,children:m?"Saving...":"Save Configuration"})]})]})]})}):null},_t=()=>e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-yellow"})}),Xt=()=>{const{users:t,setUsers:n}=Gt(),[h,d]=s.useState(!0),[o,p]=s.useState(null),[m,l]=s.useState(!1),[c,a]=s.useState(!1),[y,u]=s.useState(null),[i,N]=s.useState(null);s.useEffect(()=>{(async()=>{if(t.length>0){d(!1);return}try{const b=(await $.get("https://api.binancebotpro.com/api/users")).data.sort((L,f)=>L.username.localeCompare(f.username));n(b)}catch(C){console.error("Failed to fetch users:",C),$.isAxiosError(C)?p(`Failed to fetch users: ${C.message}. Please check your network connection and API server status.`):p("An unexpected error occurred while fetching users.")}finally{d(!1)}})()},[]);const v=x=>{u(x),l(!0)},E=x=>{u(x),a(!0)},D=x=>{n(C=>C.map(b=>b.id===x.id?x:b))},k=async x=>{if(i)return;N(x.id);const C=x.isActive?"deactivate":"activate";try{await $.put(`https://api.binancebotpro.com/api/users/${x.id}/${C}`),n(b=>b.map(L=>L.id===x.id?{...L,isActive:!L.isActive}:L))}catch(b){console.error(`Failed to ${C} user:`,b)}finally{N(null)}},A=x=>x?new Date(x).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A",w=()=>h?e.jsx(_t,{}):o?e.jsx("p",{className:"text-center p-8 text-accent-red bg-red-500/10 rounded-md",children:o}):t.length===0?e.jsx("div",{className:"text-center p-8",children:e.jsx("p",{className:"text-gray-400",children:'No users found. Get started by clicking "Add User" in the header.'})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-semibold",children:"Username"}),e.jsx("th",{className:"p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"p-4 font-semibold text-center",children:"Trades Today"}),e.jsx("th",{className:"p-4 font-semibold text-right",children:"Order Size (USD)"}),e.jsx("th",{className:"p-4 font-semibold",children:"Last Trade Date"}),e.jsx("th",{className:"p-4 font-semibold",children:"User ID"}),e.jsx("th",{className:"p-4 font-semibold text-center",children:"Actions"})]})}),e.jsx("tbody",{children:t.map((x,C)=>e.jsxs("tr",{className:`border-t border-gray-700 ${C%2===0?"bg-gray-800":"bg-gray-800/50"}`,children:[e.jsx("td",{className:"p-4 font-semibold whitespace-nowrap",children:x.username}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{htmlFor:`toggle-${x.id}`,className:"flex items-center cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:`toggle-${x.id}`,type:"checkbox",className:"sr-only",checked:x.isActive,onChange:()=>k(x),disabled:i===x.id}),e.jsx("div",{className:`block w-12 h-6 rounded-full transition-colors ${x.isActive?"bg-accent-green":"bg-gray-600"}`}),e.jsx("div",{className:`dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform ${x.isActive?"translate-x-6":""}`})]}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-300",children:x.isActive?"Active":"Inactive"})]}),i===x.id&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"})]})}),e.jsx("td",{className:"p-4 text-center font-mono whitespace-nowrap",children:x.tradesToday}),e.jsx("td",{className:"p-4 text-right font-mono whitespace-nowrap",children:x.orderSizeUSD?`$${x.orderSizeUSD.toLocaleString()}`:e.jsx("span",{className:"text-gray-500",children:"Not Set"})}),e.jsx("td",{className:"p-4 text-gray-400 whitespace-nowrap",children:A(x.lastTradeDate)}),e.jsx("td",{className:"p-4 font-mono text-sm text-gray-500 whitespace-nowrap",children:x.id}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:()=>E(x),className:"text-gray-400 hover:text-accent-yellow transition-colors","aria-label":`Configure user ${x.username}`,children:e.jsx(Ot,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>v(x),className:"text-gray-400 hover:text-accent-yellow transition-colors","aria-label":`Edit user ${x.username}`,children:e.jsx(Ut,{className:"w-5 h-5"})})]})})]},x.id))})]})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"User List"}),e.jsx("div",{className:"flex items-center gap-4",children:!h&&!o&&t.length>0&&e.jsxs("span",{className:"text-gray-400 font-medium bg-gray-700 px-3 py-1 rounded-full text-sm",children:[t.length," Users"]})})]}),w()]})}),y&&e.jsx(qt,{isOpen:m,onClose:()=>l(!1),user:y}),y&&e.jsx(Yt,{isOpen:c,onClose:()=>a(!1),user:y,onConfigUpdated:D})]})};var et=(t=>(t.LONG="LONG",t.SHORT="SHORT",t))(et||{}),ke=(t=>(t.OPEN="OPEN",t.CLOSED="CLOSED",t))(ke||{});const Ke=t=>t.toISOString().split("T")[0],Jt=()=>e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-yellow"})}),Zt=()=>{const[t,n]=s.useState([]),[h,d]=s.useState([]),[o,p]=s.useState(!0),[m,l]=s.useState(null),[c,a]=s.useState({coin:"",userId:"all",from:"",to:"",status:"all"});s.useEffect(()=>{(async()=>{try{const[x,C]=await Promise.all([$.get("https://api.binancebotpro.com/api/trades"),$.get("https://api.binancebotpro.com/api/users")]),b=x.data.map(L=>({...L,userName:L.username,side:L.side.toUpperCase(),status:L.status.toUpperCase()})).sort((L,f)=>new Date(f.entryTime).getTime()-new Date(L.entryTime).getTime());n(b),d(C.data.sort((L,f)=>L.username.localeCompare(f.username)))}catch(x){console.error("Failed to fetch trade history or users:",x),$.isAxiosError(x)?l(`Failed to fetch data: ${x.message}. Please check the API server.`):l("An unexpected error occurred while fetching data.")}finally{p(!1)}})()},[]);const y=w=>{a({...c,[w.target.name]:w.target.value})},u=(w,x)=>{a(C=>({...C,from:Ke(w),to:Ke(x)}))},i=()=>u(new Date,new Date),N=()=>{const w=new Date,x=new Date(w.setDate(w.getDate()-w.getDay())),C=new Date(x);C.setDate(C.getDate()+6),u(x,C)},v=()=>{const w=new Date,x=new Date(w.getFullYear(),w.getMonth(),1),C=new Date(w.getFullYear(),w.getMonth()+1,0);u(x,C)},E=()=>{a({coin:"",userId:"all",from:"",to:"",status:"all"})},{filteredTrades:D,summary:k}=s.useMemo(()=>{const w=t.filter(C=>{const b=new Date(C.entryTime),L=c.from?new Date(c.from):null,f=c.to?new Date(c.to):null;L&&L.setHours(0,0,0,0),f&&f.setHours(23,59,59,999);const T=c.userId==="all"?!0:C.userId===c.userId,M=c.coin?C.symbol.toLowerCase().includes(c.coin.toLowerCase()):!0,z=L?b>=L:!0,G=f?b<=f:!0,j=c.status==="all"?!0:C.status===c.status;return T&&M&&z&&G&&j});let x=null;if(c.userId!=="all"&&w.length>0){const C=w.reduce((b,L)=>b+(L.pnl||0),0);x={tradeCount:w.length,totalPnl:C}}return{filteredTrades:w,summary:x}},[c,t]),A=()=>{var w;return o?e.jsx(Jt,{}):m?e.jsx("p",{className:"text-center p-8 text-accent-red bg-red-500/10 rounded-md",children:m}):t.length===0&&!o?e.jsx("p",{className:"text-center p-8 text-gray-400",children:"No trade history found."}):D.length===0?e.jsx("p",{className:"text-center p-8 text-gray-400",children:"No trades found for the selected filters."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-semibold",children:"User"}),e.jsx("th",{className:"p-4 font-semibold",children:"Symbol"}),e.jsx("th",{className:"p-4 font-semibold",children:"Side"}),e.jsx("th",{className:"p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"p-4 font-semibold text-right",children:"Entry Price"}),e.jsx("th",{className:"p-4 font-semibold text-right",children:"Quantity"}),e.jsx("th",{className:"p-4 font-semibold text-right",children:"Order Size (USD)"}),e.jsx("th",{className:"p-4 font-semibold text-right",children:"PNL"}),e.jsx("th",{className:"p-4 font-semibold",children:"Entry Date"})]})}),e.jsx("tbody",{children:D.map((x,C)=>e.jsxs("tr",{className:`border-t border-gray-700 ${C%2===0?"bg-gray-800":"bg-gray-800/50"}`,children:[e.jsx("td",{className:"p-4 whitespace-nowrap",children:x.userName}),e.jsx("td",{className:"p-4 font-bold whitespace-nowrap",children:x.symbol}),e.jsx("td",{className:`p-4 font-semibold whitespace-nowrap ${x.side===et.LONG?"text-accent-green":"text-accent-red"}`,children:x.side}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${x.status===ke.OPEN?"bg-accent-green/20 text-accent-green":"bg-gray-600/50 text-gray-400"}`,children:x.status})}),e.jsxs("td",{className:"p-4 text-right whitespace-nowrap",children:["$",x.entryPrice.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:5})]}),e.jsx("td",{className:"p-4 text-right whitespace-nowrap",children:x.quantity.toFixed(4)}),e.jsxs("td",{className:"p-4 text-right whitespace-nowrap",children:["$",x.orderSizeUSD.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:`p-4 text-right font-mono whitespace-nowrap ${(x.pnl||0)>=0?"text-accent-green":"text-accent-red"}`,children:x.pnl!==null&&x.pnl!==void 0?`${(x.pnl||0)>=0?"+":""}${x.pnl.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:"—"}),e.jsx("td",{className:"p-4 text-gray-400 whitespace-nowrap",children:new Date(x.entryTime).toLocaleString("vi-VN")})]},x.id))}),k&&e.jsx("tfoot",{className:"bg-gray-700/50 border-t-2 border-accent-yellow",children:e.jsxs("tr",{children:[e.jsxs("td",{colSpan:7,className:"p-4 font-bold text-right text-white text-lg",children:["Summary for ",(w=h.find(x=>x.id===c.userId))==null?void 0:w.username]}),e.jsxs("td",{className:`p-4 text-right font-bold whitespace-nowrap text-lg ${k.totalPnl>=0?"text-accent-green":"text-accent-red"}`,children:["$",k.totalPnl.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("td",{className:"p-4 font-semibold text-gray-300 whitespace-nowrap",children:["(",k.tradeCount," trades)"]})]})})]})})};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400 mb-1",children:"Coin"}),e.jsx("input",{type:"text",name:"coin",placeholder:"e.g., BTC",value:c.coin,onChange:y,className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400 mb-1",children:"User"}),e.jsxs("select",{name:"userId",value:c.userId,onChange:y,className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow",children:[e.jsx("option",{value:"all",children:"All Users"}),h.map(w=>e.jsx("option",{value:w.id,children:w.username},w.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:c.status,onChange:y,className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:ke.OPEN,children:"Open"}),e.jsx("option",{value:ke.CLOSED,children:"Closed"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400 mb-1",children:"From Date"}),e.jsx("input",{type:"date",name:"from",value:c.from,onChange:y,className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400 mb-1",children:"To Date"}),e.jsx("input",{type:"date",name:"to",value:c.to,onChange:y,className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-yellow"})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 xl:grid-cols-2 gap-2",children:[e.jsx("button",{onClick:i,className:"bg-gray-600 text-white font-semibold py-2 px-3 rounded-md hover:bg-gray-500 transition-colors text-sm",children:"Today"}),e.jsx("button",{onClick:N,className:"bg-gray-600 text-white font-semibold py-2 px-3 rounded-md hover:bg-gray-500 transition-colors text-sm",children:"Week"}),e.jsx("button",{onClick:v,className:"bg-gray-600 text-white font-semibold py-2 px-3 rounded-md hover:bg-gray-500 transition-colors text-sm",children:"Month"}),e.jsx("button",{onClick:E,className:"bg-gray-600 text-white font-semibold py-2 px-3 rounded-md hover:bg-gray-500 transition-colors text-sm",children:"Clear"})]})})]})}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Trades List"}),!o&&!m&&e.jsxs("span",{className:"text-gray-400 font-medium bg-gray-700 px-3 py-1 rounded-full text-sm",children:[D.length," / ",t.length," trades shown"]})]}),A()]})]})},Qt=["BTCUSDT","ETHUSDT","SOLUSDT","BNBUSDT","XRPUSDT","DOGEUSDT","ADAUSDT","AVAXUSDT"],es={BTCUSDT:"Bitcoin",ETHUSDT:"Ethereum",SOLUSDT:"Solana",BNBUSDT:"Binance Coin",XRPUSDT:"Ripple",DOGEUSDT:"Dogecoin",ADAUSDT:"Cardano",AVAXUSDT:"Avalanche"},ts=()=>e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-yellow"})}),ss=({trend:t})=>{let n="bg-gray-600/50 text-gray-300";return t==="UPTREND"?n="bg-accent-green/20 text-accent-green":t==="DOWNTREND"&&(n="bg-accent-red/20 text-accent-red"),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${n}`,children:t||"N/A"})},Ce=t=>{const n={minimumFractionDigits:2,maximumFractionDigits:t<1?5:2};return t.toLocaleString(void 0,n)},rs=()=>{const[t,n]=s.useState([]),[h,d]=s.useState(!0),[o,p]=s.useState(null);return s.useEffect(()=>{const m=async()=>{try{const c=Qt.map(u=>$.get(`https://api.binancebotpro.com/api/market-data/state/${u.toLowerCase()}`)),y=(await Promise.all(c)).filter(u=>u.data&&typeof u.data.currentPrice=="number").map(u=>{var N,v;const i=u.data;return{symbol:i.symbol,name:es[i.symbol]||i.symbol.replace("USDT",""),price:i.currentPrice,support:((N=i.supportLevels)==null?void 0:N[0])||0,resistance:((v=i.resistanceLevels)==null?void 0:v[0])||0,trend:i.trend}});n(y),o&&p(null)}catch(c){console.error("Failed to fetch market data:",c),t.length===0&&($.isAxiosError(c)?p(`Failed to fetch market data: ${c.message}. Please check API server status.`):p("An unexpected error occurred while fetching market data."))}finally{h&&d(!1)}};m();const l=setInterval(m,1e4);return()=>clearInterval(l)},[]),h?e.jsx("div",{className:"space-y-8",children:e.jsx(ts,{})}):o?e.jsx("div",{className:"space-y-8",children:e.jsx("p",{className:"text-center p-8 text-accent-red bg-red-500/10 rounded-md",children:o})}):e.jsx("div",{className:"space-y-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map(m=>e.jsx(me,{to:`/monitor/${m.symbol}`,className:"block group",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 flex flex-col justify-between h-full transition-all group-hover:shadow-lg group-hover:shadow-accent-yellow/10 group-hover:border-accent-yellow/50 group-hover:-translate-y-1",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:m.symbol.replace("USDT","")}),e.jsx("span",{className:"text-sm text-gray-400 ml-2",children:m.name})]}),e.jsx(ss,{trend:m.trend})]}),e.jsxs("div",{className:"text-3xl font-light text-white mb-6",children:["$",Ce(m.price)]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Support"}),e.jsxs("span",{className:"font-mono text-white",children:["$",Ce(m.support)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Resistance"}),e.jsxs("span",{className:"font-mono text-white",children:["$",Ce(m.resistance)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Futures Price"}),e.jsxs("span",{className:"font-mono text-accent-yellow",children:["$",Ce(m.price*1.005)]})]})]})]})},m.symbol))})})},as=(t,n)=>{const h=[];for(let d=n-1;d<t.length;d++){const o=t.slice(d-n+1,d+1).reduce((p,m)=>p+m.close,0);h.push({time:t[d].time,value:o/n})}return h},ns=(t,n,h)=>{const d=[];for(let o=n-1;o<t.length;o++){const m=t.slice(o-n+1,o+1).map(a=>a.close),l=m.reduce((a,y)=>a+y,0)/n,c=Math.sqrt(m.map(a=>Math.pow(a-l,2)).reduce((a,y)=>a+y,0)/n);d.push({time:t[o].time,upper:l+h*c,middle:l,lower:l-h*c})}return d},X={TENKAN:"#2962FF",KIJUN:"#B71C1C",CHIKOU:"#43A047",SPAN_A:"#00897B",SPAN_B:"#E53935"},ls=(t,n=9,h=26,d=52)=>{const o=[],p=[],m=[],l=[],c=[];for(let a=0;a<t.length;a++){const y=t[a].time;if(a>=n-1){const u=t.slice(a-n+1,a+1);o.push({time:y,value:(Math.max(...u.map(i=>i.high))+Math.min(...u.map(i=>i.low)))/2})}if(a>=h-1){const u=t.slice(a-h+1,a+1);p.push({time:y,value:(Math.max(...u.map(i=>i.high))+Math.min(...u.map(i=>i.low)))/2})}if(a>=h-1){const u=t.slice(a-n+1,a+1),i=(Math.max(...u.map(E=>E.high))+Math.min(...u.map(E=>E.low)))/2,N=t.slice(a-h+1,a+1),v=(Math.max(...N.map(E=>E.high))+Math.min(...N.map(E=>E.low)))/2;m.push({time:y,value:(i+v)/2})}if(a>=d-1){const u=t.slice(a-d+1,a+1);l.push({time:y,value:(Math.max(...u.map(i=>i.high))+Math.min(...u.map(i=>i.low)))/2})}c.push({time:y,value:t[a].close})}return{tenkan:o,kijun:p,senkouA:m,senkouB:l,chikou:c}},os=(t,n=14)=>{const h=[];let d=0,o=0;for(let l=1;l<=n;l++){const c=t[l].close-t[l-1].close;c>0?d+=c:o+=Math.abs(c)}let p=d/n,m=o/n;for(let l=n+1;l<t.length;l++){const c=t[l].close-t[l-1].close,a=c>0?c:0,y=c<0?Math.abs(c):0;p=(p*(n-1)+a)/n,m=(m*(n-1)+y)/n;const u=p/m;h.push({time:t[l].time,value:100-100/(1+u)})}return h},is=t=>{const n=.15384615384615385,h=2/27,d=2/10;let o=t[0].close,p=t[0].close;const m=[];for(let a=0;a<t.length;a++)o=t[a].close*n+o*(1-n),p=t[a].close*h+p*(1-h),m.push(o-p);let l=m[0];const c=[];for(let a=0;a<t.length;a++)l=m[a]*d+l*(1-d),a>26&&c.push({time:t[a].time,macd:m[a],signal:l,hist:m[a]-l});return c},cs={"1m":"1m","5m":"5m","15m":"15m","1h":"1H","4h":"4H","1d":"1D"},Me=t=>t?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t):"...",ds=({symbol:t,currentPrice:n,marketType:h,setMarketType:d,isMobile:o})=>{const[p,m]=s.useState([]),[l,c]=s.useState("custom"),[a,y]=s.useState(""),[u,i]=s.useState(""),[N,v]=s.useState(!1),[E,D]=s.useState(!1),[k,A]=s.useState(!1),[w,x]=s.useState([]),[C,b]=s.useState([]),[L,f]=s.useState([]),[T,M]=s.useState("LIMIT"),[z,G]=s.useState(""),[j,O]=s.useState(""),[W,ee]=s.useState("COIN"),[Y,te]=s.useState(20),H=(t==null?void 0:t.replace("USDT",""))||"COIN";s.useEffect(()=>{(async()=>{try{const S=await $.get("https://api.binancebotpro.com/api/users");m(S.data)}catch(S){console.error("Failed to fetch users",S)}})()},[]);const _=async g=>{const S=g.target.value;if(c(S),S==="custom"){y(""),i(""),J();return}D(!0);try{const I=await $.get(`https://api.binancebotpro.com/api/users/${S}/keys`);if(I.data){const se=I.data.apiKey||"",V=I.data.apiSecret||"";y(se),i(V),ie(se,V)}}catch(I){console.error("Failed to fetch keys",I),alert("Không thể lấy Key của user này."),J()}finally{D(!1)}},J=()=>{x([]),b([]),f([])},ie=async(g=a,S=u)=>{if(!(!g||!S)){A(!0);try{const I="https://api.binancebotpro.com/api/binance/proxy",V=(await $.post(`${I}/spot/account`,{apiKey:g,apiSecret:S})).data.balances.filter(F=>parseFloat(F.free)>0||parseFloat(F.locked)>0).map(F=>({asset:F.asset,free:parseFloat(F.free),locked:parseFloat(F.locked)}));x(V);const ge=(await $.post(`${I}/futures/balance`,{apiKey:g,apiSecret:S})).data.filter(F=>parseFloat(F.balance)>0).map(F=>({asset:F.asset,balance:parseFloat(F.balance),availableBalance:parseFloat(F.availableBalance)}));b(ge);const q=(await $.post(`${I}/futures/positions`,{apiKey:g,apiSecret:S})).data.filter(F=>parseFloat(F.positionAmt)!==0).map(F=>({symbol:F.symbol,positionSide:F.positionSide,positionAmt:parseFloat(F.positionAmt),entryPrice:parseFloat(F.entryPrice),markPrice:parseFloat(F.markPrice),unRealizedProfit:parseFloat(F.unRealizedProfit),leverage:parseInt(F.leverage),liquidationPrice:parseFloat(F.liquidationPrice)}));f(q)}catch(I){console.error("Error fetching Binance data:",I)}finally{A(!1)}}},Z=g=>{if(g==="SPOT"){const S=w.find(I=>I.asset==="USDT");return S?S.free:0}else{const S=C.find(I=>I.asset==="USDT");return S?S.availableBalance:0}};s.useEffect(()=>{n&&z===""&&G(n.toString())},[n]);const oe=()=>T==="LIMIT"&&z?parseFloat(z):n,fe=g=>{const S=Z(h),I=oe();I&&O(W==="USDT"?(S*(g/100)).toFixed(2):(S*(g/100)/I).toFixed(4))},de=s.useMemo(()=>{const g=parseFloat(j),S=oe();return!g||!S?null:W==="COIN"?`≈ ${(g*S).toLocaleString("en-US",{style:"currency",currency:"USD"})}`:`≈ ${(g/S).toFixed(5)} ${H}`},[j,W,z,n,T]),U=g=>{if(!a)return alert("Vui lòng chọn tài khoản hoặc nhập API Key");alert(`Đang gửi lệnh ${g} ${t} lên sàn... (Chức năng cần Backend Proxy)`)};return e.jsxs("div",{className:`bg-gray-800 border border-gray-700 flex flex-col overflow-hidden ${o?"border-t rounded-t-xl":"rounded-lg h-full"}`,children:[e.jsxs("div",{className:"flex bg-gray-900 p-1 rounded-t-lg",children:[e.jsx("button",{onClick:()=>d("SPOT"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${h==="SPOT"?"bg-gray-700 text-white":"text-gray-500 hover:text-gray-300"}`,children:"SPOT"}),e.jsx("button",{onClick:()=>d("FUTURES"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${h==="FUTURES"?"bg-accent-yellow text-gray-900":"text-gray-500 hover:text-gray-300"}`,children:"FUTURES"})]}),e.jsxs("div",{className:"overflow-y-auto p-3 custom-scrollbar space-y-4 flex-grow",children:[e.jsxs("div",{className:"space-y-3 border-b border-gray-700 pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px] text-gray-400 font-bold uppercase",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ve,{})," Account"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx("button",{onClick:()=>ie(a,u),disabled:k,className:`text-xs ${k?"animate-spin text-accent-yellow":"text-gray-400 hover:text-white"}`,title:"Làm mới dữ liệu",children:e.jsx(qe,{})}),e.jsx("span",{className:a?"text-green-400":"text-gray-500",children:a?"Connected":"No Key"})]})]}),e.jsxs("select",{value:l,onChange:_,className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-2 text-xs text-white outline-none cursor-pointer",children:[e.jsx("option",{value:"custom",children:"-- Nhập tay (Custom) --"}),p.map(g=>e.jsxs("option",{value:g.id,children:[g.username," (",g.isActive?"Active":"Inactive",")"]},g.id))]}),l==="custom"&&e.jsxs("div",{className:"space-y-2 pt-1",children:[e.jsx("input",{type:"text",placeholder:"API Key",value:a,onChange:g=>y(g.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-xs text-white"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:N?"text":"password",placeholder:"Secret Key",value:u,onChange:g=>i(g.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-xs text-white pr-8"}),e.jsx("button",{className:"absolute right-2 top-2 text-gray-400",onClick:()=>v(!N),children:N?e.jsx(Ye,{size:12}):e.jsx(_e,{size:12})})]})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 bg-gray-900/50 p-2 rounded border border-gray-600",children:[e.jsxs("div",{className:`text-center border-r border-gray-700 ${h==="SPOT"?"opacity-100":"opacity-50"}`,children:[e.jsx("p",{className:"text-[9px] text-gray-400 uppercase",children:"Spot USDT"}),e.jsx("p",{className:"text-xs font-bold text-white",children:Me(Z("SPOT"))})]}),e.jsxs("div",{className:`text-center ${h==="FUTURES"?"opacity-100":"opacity-50"}`,children:[e.jsx("p",{className:"text-[9px] text-gray-400 uppercase",children:"Futures USDT"}),e.jsx("p",{className:"text-xs font-bold text-accent-yellow",children:Me(Z("FUTURES"))})]})]})]}),h==="FUTURES"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[e.jsx("span",{children:"Leverage"}),e.jsxs("span",{className:"text-accent-yellow font-bold",children:[Y,"x"]})]}),e.jsx("input",{type:"range",min:"1",max:"125",step:"1",value:Y,onChange:g=>te(Number(g.target.value)),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-accent-yellow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex bg-gray-900 rounded p-0.5",children:[e.jsx("button",{onClick:()=>M("LIMIT"),className:`flex-1 text-[10px] py-1.5 rounded transition ${T==="LIMIT"?"bg-gray-700 text-accent-yellow font-bold":"text-gray-500"}`,children:"Limit"}),e.jsx("button",{onClick:()=>M("MARKET"),className:`flex-1 text-[10px] py-1.5 rounded transition ${T==="MARKET"?"bg-gray-700 text-accent-yellow font-bold":"text-gray-500"}`,children:"Market"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-2 text-[10px] text-gray-500",children:"Price"}),e.jsx("input",{type:"number",inputMode:"decimal",disabled:T==="MARKET",value:T==="MARKET"?n:z,onChange:g=>G(g.target.value),className:`w-full bg-gray-900 border border-gray-600 rounded px-2 py-2 pl-10 text-sm text-right text-white font-mono ${T==="MARKET"&&"opacity-50"}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-2 text-[10px] text-gray-500 font-medium pointer-events-none",children:W==="COIN"?"Amount":"Total"}),e.jsx("input",{type:"number",inputMode:"decimal",value:j,onChange:g=>O(g.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-2 pl-12 pr-16 text-sm text-right text-white font-mono",placeholder:"0.00"}),e.jsx("button",{onClick:()=>ee(g=>g==="COIN"?"USDT":"COIN"),className:"absolute right-1 top-1 bottom-1 px-2 bg-gray-700 hover:bg-gray-600 border border-gray-600 rounded flex items-center justify-center gap-1 cursor-pointer transition-all z-10 group",children:e.jsx("span",{className:"text-[10px] font-bold text-gray-200",children:W==="COIN"?H:"USDT"})})]}),e.jsx("div",{className:"text-right text-[10px] text-gray-500 h-3 font-mono",children:de})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1",children:[25,50,75,100].map(g=>e.jsxs("button",{onClick:()=>fe(g),className:"bg-gray-700 hover:bg-gray-600 text-[10px] py-1.5 rounded text-gray-400 hover:text-white transition",children:[g,"%"]},g))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pb-2",children:[e.jsx("button",{onClick:()=>U("BUY"),className:"bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded text-xs transition shadow-lg",children:h==="FUTURES"?"LONG":"BUY"}),e.jsx("button",{onClick:()=>U("SELL"),className:"bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded text-xs transition shadow-lg",children:h==="FUTURES"?"SHORT":"SELL"})]}),e.jsxs("div",{className:"border-t border-gray-700 pt-2",children:[e.jsxs("div",{className:"flex gap-2 mb-2 items-center text-[10px] font-bold uppercase text-gray-500",children:[e.jsx(dt,{})," ",h==="SPOT"?"Spot Assets":"Open Positions"]}),e.jsxs("div",{className:"min-h-[120px]",children:[h==="SPOT"&&a&&e.jsx("div",{className:"space-y-2",children:w.length===0?e.jsx("p",{className:"text-center text-[10px] text-gray-500 py-2",children:"Ví trống"}):w.map((g,S)=>e.jsxs("div",{className:"bg-gray-900/50 p-2 rounded border border-gray-700 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-700 flex items-center justify-center text-[9px] font-bold text-white",children:g.asset[0]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-bold text-white",children:g.asset}),e.jsxs("p",{className:"text-[9px] text-gray-500",children:["Locked: ",g.locked]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-[11px] font-mono text-white",children:g.free})})]},S))}),h==="FUTURES"&&a&&e.jsx("div",{className:"space-y-2",children:L.length===0?e.jsx("p",{className:"text-center text-[10px] text-gray-500 py-2",children:"Không có lệnh mở"}):L.map((g,S)=>e.jsxs("div",{className:"bg-gray-900/50 p-2 rounded border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-[11px] font-bold text-white flex items-center gap-1",children:[g.symbol,e.jsxs("span",{className:`text-[9px] px-1 rounded ${parseFloat(g.positionAmt.toString())>0?"bg-green-900 text-green-400":"bg-red-900 text-red-400"}`,children:[parseFloat(g.positionAmt.toString())>0?"L":"S"," ",g.leverage,"x"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:`text-[11px] font-mono font-bold ${g.unRealizedProfit>=0?"text-green-400":"text-red-400"}`,children:[g.unRealizedProfit>0?"+":"",parseFloat(g.unRealizedProfit.toString()).toFixed(2)," u"]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[9px] text-gray-400 mt-1",children:[e.jsxs("div",{children:["Size: ",e.jsx("span",{className:"text-gray-300",children:Math.abs(g.positionAmt)})]}),e.jsxs("div",{className:"text-center",children:["Entry: ",e.jsx("span",{className:"text-gray-300",children:parseFloat(g.entryPrice.toString()).toFixed(2)})]}),e.jsxs("div",{className:"text-right",children:["Liq: ",e.jsx("span",{className:"text-orange-400",children:parseFloat(g.liquidationPrice.toString()).toFixed(2)})]})]})]},S))})]})]})]})]})},xs=()=>{const{symbol:t}=ct(),[n,h]=s.useState("FUTURES"),[d,o]=s.useState(window.innerWidth<768),p=s.useRef(null),m=s.useRef(null),l=s.useRef(null),c=s.useRef(null),a=s.useRef(null),y=s.useRef(null),u=s.useRef({}),i=s.useRef({}),N=s.useRef([]),[v,E]=s.useState([]),[D,k]=s.useState("15m"),[A,w]=s.useState({sma:!1,bb:!1,ichimoku:!0,sr:!0,rsi:!1,macd:!1});s.useEffect(()=>{const b=()=>o(window.innerWidth<768);return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),s.useEffect(()=>{if(!p.current)return;l.current&&(l.current.remove(),l.current=null);const b=Fe(p.current,{layout:{background:{type:Ie.Solid,color:"#1e1e1e"},textColor:"#d1d5db"},grid:{vertLines:{color:"#2d2d2d"},horzLines:{color:"#2d2d2d"}},crosshair:{mode:At.Normal},rightPriceScale:{borderColor:"#2d2d2d",scaleMargins:{top:.1,bottom:.1}},timeScale:{timeVisible:!0,secondsVisible:!1,rightOffset:d?2:5},handleScroll:{vertTouchDrag:!1},width:p.current.clientWidth,height:d?350:400});l.current=b,a.current=b.addCandlestickSeries({upColor:"#22c55e",downColor:"#ef4444",borderUpColor:"#22c55e",borderDownColor:"#ef4444",wickUpColor:"#22c55e",wickDownColor:"#ef4444"}),y.current=b.addHistogramSeries({priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.85,bottom:0}});const L=()=>{l.current&&p.current&&l.current.applyOptions({width:p.current.clientWidth})};return window.addEventListener("resize",L),()=>{window.removeEventListener("resize",L),l.current&&(l.current.remove(),l.current=null)}},[d]),s.useEffect(()=>{if(m.current)if(A.rsi||A.macd){c.current&&(c.current.remove(),c.current=null);const b=Fe(m.current,{layout:{background:{type:Ie.Solid,color:"#1e1e1e"},textColor:"#d1d5db"},grid:{vertLines:{color:"#2d2d2d"},horzLines:{color:"#2d2d2d"}},width:m.current.clientWidth,height:d?100:150,timeScale:{visible:!0},handleScroll:{vertTouchDrag:!1}});c.current=b;const L=()=>{c.current&&m.current&&c.current.applyOptions({width:m.current.clientWidth})};return window.addEventListener("resize",L),()=>{window.removeEventListener("resize",L),c.current&&(c.current.remove(),c.current=null)}}else c.current&&(c.current.remove(),c.current=null)},[A.rsi,A.macd,d]),s.useEffect(()=>{if(!t)return;let b=!1;const L=async()=>{try{const T=n==="FUTURES"?"https://fapi.binance.com/fapi/v1/klines":"https://api.binance.com/api/v3/klines",M=await $.get(T,{params:{symbol:t.toUpperCase(),interval:D,limit:500}});if(b)return;const z=M.data.map(G=>({time:G[0]/1e3,open:parseFloat(G[1]),high:parseFloat(G[2]),low:parseFloat(G[3]),close:parseFloat(G[4]),volume:parseFloat(G[5])}));E(z)}catch(T){console.error(T)}};L();const f=setInterval(L,2e3);return()=>{b=!0,clearInterval(f)}},[t,D,n]);const x=s.useMemo(()=>{if(v.length===0)return{support:null,resistance:null};const b=Math.min(100,v.length),L=v.slice(v.length-b);return{support:Math.min(...L.map(f=>f.low)),resistance:Math.max(...L.map(f=>f.high))}},[v]);s.useEffect(()=>{var L;if(!l.current||!a.current||v.length===0)return;a.current.setData(v),(L=y.current)==null||L.setData(v.map(f=>({time:f.time,value:f.volume,color:f.close>=f.open?"rgba(34, 197, 94, 0.3)":"rgba(239, 68, 68, 0.3)"})));const b=l.current;if(a.current)try{N.current.forEach(f=>{var T;try{(T=a.current)==null||T.removePriceLine(f)}catch{}}),N.current=[],A.sr&&(x.support&&N.current.push(a.current.createPriceLine({price:x.support,color:"#22c55e",lineWidth:1,lineStyle:pe.Dashed,title:"SUP",axisLabelVisible:!0})),x.resistance&&N.current.push(a.current.createPriceLine({price:x.resistance,color:"#ef4444",lineWidth:1,lineStyle:pe.Dashed,title:"RES",axisLabelVisible:!0})))}catch{}if(!A.sma&&u.current.sma&&(b.removeSeries(u.current.sma),delete u.current.sma),!A.bb&&u.current.bb&&(u.current.bb.forEach(f=>b.removeSeries(f)),delete u.current.bb),!A.ichimoku&&u.current.ich&&(Object.values(u.current.ich).forEach(f=>b.removeSeries(f)),delete u.current.ich),A.sma&&(u.current.sma||(u.current.sma=b.addLineSeries({color:"#F0B90B",lineWidth:2})),u.current.sma.setData(as(v,20))),A.bb){u.current.bb||(u.current.bb=[b.addLineSeries({color:"#3b82f6",lineWidth:1}),b.addLineSeries({color:"#3b82f6",lineWidth:1})]);const f=ns(v,20,2);u.current.bb[0].setData(f.map(T=>({time:T.time,value:T.upper}))),u.current.bb[1].setData(f.map(T=>({time:T.time,value:T.lower})))}if(A.ichimoku){const f=ls(v);u.current.ich||(u.current.ich={tenkan:b.addLineSeries({color:X.TENKAN,lineWidth:1}),kijun:b.addLineSeries({color:X.KIJUN,lineWidth:1}),senkouA:b.addLineSeries({color:X.SPAN_A,lineWidth:1}),senkouB:b.addLineSeries({color:X.SPAN_B,lineWidth:1}),chikou:b.addLineSeries({color:X.CHIKOU,lineWidth:1,lineStyle:pe.Dashed})}),u.current.ich.tenkan.setData(f.tenkan),u.current.ich.kijun.setData(f.kijun),u.current.ich.senkouA.setData(f.senkouA),u.current.ich.senkouB.setData(f.senkouB),u.current.ich.chikou.setData(f.chikou)}if(c.current){const f=c.current;if(!A.rsi&&i.current.rsi&&(f.removeSeries(i.current.rsi),delete i.current.rsi),!A.macd&&i.current.macd&&(f.removeSeries(i.current.macd.hist),f.removeSeries(i.current.macd.macd),f.removeSeries(i.current.macd.signal),delete i.current.macd),A.rsi){if(!i.current.rsi){const T=f.addLineSeries({color:"#a78bfa",lineWidth:2});T.createPriceLine({price:70,color:"#ef4444",lineWidth:1,lineStyle:pe.Dashed}),T.createPriceLine({price:30,color:"#22c55e",lineWidth:1,lineStyle:pe.Dashed}),i.current.rsi=T}i.current.rsi.setData(os(v))}if(A.macd){i.current.macd||(i.current.macd={hist:f.addHistogramSeries(),macd:f.addLineSeries({color:"#2962FF"}),signal:f.addLineSeries({color:"#FF6D00"})});const T=is(v);i.current.macd.hist.setData(T.map(M=>({time:M.time,value:M.hist,color:M.hist>0?"#26a69a":"#ef5350"}))),i.current.macd.macd.setData(T.map(M=>({time:M.time,value:M.macd}))),i.current.macd.signal.setData(T.map(M=>({time:M.time,value:M.signal})))}f.timeScale().fitContent()}},[v,A,x]);const C=v[v.length-1];return e.jsxs("div",{className:`flex flex-col lg:flex-row gap-4 bg-gray-950 text-gray-100 ${d?"p-2 pb-20":"p-4 h-[calc(100vh-80px)]"}`,children:[e.jsxs("div",{className:`flex-grow flex flex-col bg-gray-800 border border-gray-700 rounded-lg shadow-lg overflow-hidden relative ${d?"min-h-[450px]":""}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-2 border-b border-gray-800 bg-gray-900 z-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{to:"/monitor",className:"p-2 bg-gray-800 rounded hover:bg-gray-700",children:e.jsx($t,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-base font-bold flex gap-2",children:[t," ",e.jsx("span",{className:"text-[10px] bg-gray-800 px-1.5 py-0.5 rounded text-gray-400",children:n})]}),e.jsx("p",{className:"text-lg font-mono font-bold text-white leading-none",children:Me(C==null?void 0:C.close)})]})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto no-scrollbar max-w-[150px] lg:max-w-none",children:Object.keys(cs).map(b=>e.jsx("button",{onClick:()=>k(b),className:`px-2 py-1 text-[10px] rounded font-bold whitespace-nowrap ${D===b?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:b},b))})]}),e.jsxs("div",{className:"flex gap-2 p-2 bg-gray-900 border-b border-gray-800 overflow-x-auto no-scrollbar text-[10px] font-bold",children:[e.jsx("button",{onClick:()=>w(b=>({...b,sr:!b.sr})),className:`px-3 py-1 rounded whitespace-nowrap ${A.sr?"bg-gray-600 text-white":"bg-gray-700 text-gray-400"}`,children:"S/R"}),e.jsx("button",{onClick:()=>w(b=>({...b,sma:!b.sma})),className:`px-3 py-1 rounded whitespace-nowrap ${A.sma?"bg-yellow-900/50 text-yellow-400":"bg-gray-700 text-gray-400"}`,children:"SMA"}),e.jsx("button",{onClick:()=>w(b=>({...b,bb:!b.bb})),className:`px-3 py-1 rounded whitespace-nowrap ${A.bb?"bg-blue-900/50 text-blue-400":"bg-gray-700 text-gray-400"}`,children:"BB"}),e.jsx("button",{onClick:()=>w(b=>({...b,ichimoku:!b.ichimoku})),className:`px-3 py-1 rounded whitespace-nowrap ${A.ichimoku?"bg-green-900/50 text-green-400":"bg-gray-700 text-gray-400"}`,children:"Cloud"}),e.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"}),e.jsx("button",{onClick:()=>w(b=>({...b,rsi:!b.rsi,macd:!1})),className:`px-3 py-1 rounded whitespace-nowrap ${A.rsi?"bg-purple-900/50 text-purple-400":"bg-gray-700 text-gray-400"}`,children:"RSI"}),e.jsx("button",{onClick:()=>w(b=>({...b,macd:!b.macd,rsi:!1})),className:`px-3 py-1 rounded whitespace-nowrap ${A.macd?"bg-blue-900/50 text-blue-400":"bg-gray-700 text-gray-400"}`,children:"MACD"})]}),A.ichimoku&&e.jsxs("div",{className:"absolute top-[88px] md:top-16 left-4 z-10 bg-gray-900/80 backdrop-blur-sm p-2 rounded border border-gray-700 text-[10px] space-y-1 shadow-lg pointer-events-none",children:[e.jsx("div",{className:"font-bold text-gray-300 mb-1 border-b border-gray-700 pb-1",children:"Ichimoku"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:X.TENKAN}})," ",e.jsx("span",{style:{color:X.TENKAN},children:"Tenkan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:X.KIJUN}})," ",e.jsx("span",{style:{color:X.KIJUN},children:"Kijun"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:X.SPAN_A}})," ",e.jsx("span",{style:{color:X.SPAN_A},children:"Span A"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:X.SPAN_B}})," ",e.jsx("span",{style:{color:X.SPAN_B},children:"Span B"})]})]}),e.jsxs("div",{className:"flex-grow flex flex-col relative bg-[#121212]",children:[e.jsx("div",{className:"flex-grow relative border-b border-gray-800",children:e.jsx("div",{ref:p,className:"absolute inset-0"})}),(A.rsi||A.macd)&&e.jsx("div",{className:`${d?"h-[120px]":"h-[150px]"} relative border-t border-gray-700 bg-[#1e1e1e]`,children:e.jsx("div",{ref:m,className:"absolute inset-0"})})]})]}),e.jsx("div",{className:"w-full lg:w-80 flex-shrink-0 bg-gray-900 z-30",children:e.jsx(ds,{symbol:t||"",currentPrice:(C==null?void 0:C.close)||0,marketType:n,setMarketType:h,isMobile:d})})]})},ms=()=>{const t=Le(),[n,h]=s.useState({username:"",email:"",password:"",confirmPassword:"",referrerCode:""}),[d,o]=s.useState(""),[p,m]=s.useState(""),[l,c]=s.useState(!1),a=u=>{h({...n,[u.target.name]:u.target.value})},y=async u=>{if(u.preventDefault(),o(""),m(""),n.password!==n.confirmPassword){o("Passwords do not match.");return}c(!0);try{(await $.post("https://api.binancebotpro.com/api/auth/register",{username:n.username,email:n.email,password:n.password,referrerCode:n.referrerCode})).status===200&&(m("Đăng ký thành công"),setTimeout(()=>{t("/login")},2e3))}catch(i){console.error("Registration failed:",i),$.isAxiosError(i)&&i.response?o(i.response.data.message||"Registration failed. Please try again."):o("An unexpected error occurred during registration.")}finally{c(!1)}};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md p-8 space-y-8 bg-gray-800 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Ue,{className:"h-12 w-12 text-accent-yellow mb-2"}),e.jsx("h2",{className:"text-3xl font-bold text-center text-white",children:"Create Account"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-400",children:"Join TradingBot Dashboard"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:y,children:[e.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[e.jsx("div",{children:e.jsx("input",{name:"username",type:"text",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-accent-yellow focus:border-accent-yellow focus:z-10 sm:text-sm rounded-t-md",placeholder:"Username",value:n.username,onChange:a,disabled:l})}),e.jsx("div",{children:e.jsx("input",{name:"email",type:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-accent-yellow focus:border-accent-yellow focus:z-10 sm:text-sm",placeholder:"Email address",value:n.email,onChange:a,disabled:l})}),e.jsx("div",{children:e.jsx("input",{name:"password",type:"password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-accent-yellow focus:border-accent-yellow focus:z-10 sm:text-sm",placeholder:"Password",value:n.password,onChange:a,disabled:l})}),e.jsx("div",{children:e.jsx("input",{name:"confirmPassword",type:"password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-accent-yellow focus:border-accent-yellow focus:z-10 sm:text-sm",placeholder:"Confirm Password",value:n.confirmPassword,onChange:a,disabled:l})}),e.jsx("div",{children:e.jsx("input",{name:"referrerCode",type:"text",className:"appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-accent-yellow focus:border-accent-yellow focus:z-10 sm:text-sm rounded-b-md",placeholder:"Referrer Code (Optional)",value:n.referrerCode,onChange:a,disabled:l})})]}),d&&e.jsx("p",{className:"text-sm text-accent-red text-center",children:d}),p&&e.jsx("p",{className:"text-sm text-accent-green text-center",children:p}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-semibold rounded-md text-gray-900 bg-accent-yellow hover:bg-accent-yellow-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-yellow focus:ring-offset-gray-800 transition-colors disabled:bg-accent-yellow/50 disabled:cursor-not-allowed",disabled:l,children:l?"Registering...":"Register"})}),e.jsxs("div",{className:"text-sm text-center",children:[e.jsx("span",{className:"text-gray-400",children:"Already have an account? "}),e.jsx(me,{to:"/login",className:"font-medium text-accent-yellow hover:text-accent-yellow-dark",children:"Sign in"})]})]})]})})},us=[{id:"BTC",name:"Bitcoin"},{id:"ETH",name:"Ethereum"},{id:"BNB",name:"Binance Coin"},{id:"SOL",name:"Solana"},{id:"XRP",name:"Ripple"},{id:"DOGE",name:"Dogecoin"},{id:"ADA",name:"Cardano"},{id:"AVAX",name:"Avalanche"},{id:"LINK",name:"Chainlink"},{id:"DOT",name:"Polkadot"},{id:"TRX",name:"Tron"},{id:"LTC",name:"Litecoin"}];function gs(){const[t,n]=s.useState("CLASSIC"),[h,d]=s.useState("BTC"),[o,p]=s.useState(null),[m,l]=s.useState(!0),[c,a]=s.useState(1e3),[y,u]=s.useState(10),[i,N]=s.useState("SHORT"),[v,E]=s.useState(6),[D,k]=s.useState(""),[A,w]=s.useState(""),[x,C]=s.useState(5),[b,L]=s.useState(1.5),[f,T]=s.useState(null);s.useEffect(()=>{(async()=>{l(!0);try{const O=await $.get(`https://fapi.binance.com/fapi/v1/ticker/price?symbol=${h}USDT`),W=parseFloat(O.data.price);p(W),i==="SHORT"?(k(W.toFixed(2)),w((W*1.1).toFixed(2))):(w(W.toFixed(2)),k((W*.9).toFixed(2)))}catch(O){console.error("Error init price",O)}finally{l(!1)}})()},[h,i]),s.useEffect(()=>{const j=setInterval(async()=>{try{const O=await $.get(`https://fapi.binance.com/fapi/v1/ticker/price?symbol=${h}USDT`);p(parseFloat(O.data.price))}catch{}},5e3);return()=>clearInterval(j)},[h]),s.useEffect(()=>{T(null)},[h,i,c,y,v,D,A,x,t,b]);const M=j=>{if(!j&&j!==0)return"...";let O=2;return j<1e-4?O=8:j<.01?O=6:j<1?O=4:j<50&&(O=3),new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:O}).format(j)},z=j=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}).format(j),G=()=>{if(!o)return;let j=[],O=t==="CLASSIC"?v:x;if(t==="CLASSIC"){let S=c*y*.02;for(let I=0;I<O;I++){const se=1.5*I,V=i==="LONG"?o*(1-se/100):o*(1+se/100);I>0&&(S=S*2),j.push({level:I+1,price:V,volume:S,coinSize:S/V,weight:0})}}else{const U=parseFloat(D),g=parseFloat(A);if(!U||!g||U>=g)return alert("Vui lòng nhập khoảng giá Min < Max hợp lệ.");let S=0;for(let q=0;q<O;q++)S+=Math.pow(b,q);const se=c*y/S;let V,xe;i==="LONG"?(V=Math.min(o,g),xe=U):(V=Math.max(o,U),xe=g);const ge=Math.abs(V-xe),he=O>1?ge/(O-1):0;for(let q=0;q<O;q++){let F=0;i==="LONG"?F=V-he*q:F=V+he*q,i==="LONG"&&F<U&&(F=U),i==="SHORT"&&F>g&&(F=g);const Q=se*Math.pow(b,q);j.push({level:q+1,price:F,volume:Q,coinSize:Q/F,weight:Math.pow(b,q)})}}const W=j.reduce((U,g)=>U+g.volume,0),ee=j.reduce((U,g)=>U+g.coinSize,0),Y=W/ee,te=W/y,H=c-te;let _=0,J=0,ie=0,Z=!1,oe=!0;if(H<0)Z=!0;else{const U=H/ee,g=Y*.004;i==="LONG"?(_=Y-U+g,J=_*1.005,t==="RANGE"&&_>=parseFloat(D)&&(oe=!1)):(_=Y+U-g,J=_*.995,t==="RANGE"&&_<=parseFloat(A)&&(oe=!1)),J<0&&(J=0),_<0&&(_=0),ie=Math.abs(Y-J)*ee}const de=[2,5,10,20].map(U=>{let g=i==="LONG"?Y*(1+U/100):Y*(1-U/100);const S=ee*Math.abs(g-Y),I=te>0?S/te*100:0;return{targetPercent:U,price:g,pnl:S,roe:I}});T({plans:j,exitPlans:de,avgPrice:Y,totalVolume:W,totalMargin:te,liquidationPrice:Z?null:_,suggestedSL:Z?null:J,lossAtSL:ie,isRekt:Z,isSafeRange:oe})};return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-3 md:p-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 mb-6",children:[e.jsxs(me,{to:"/",className:"flex items-center gap-2 p-2 px-4 rounded-full bg-gray-800 hover:bg-gray-700 transition text-gray-300 hover:text-white text-sm",children:[e.jsx(Xe,{})," Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Futures Strategy Planner"}),e.jsxs("p",{className:"text-gray-400 text-xs sm:text-sm",children:["Chiến lược ",i," ",h]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-gray-800 border border-gray-700 rounded-xl p-5 shadow-lg h-fit",children:[e.jsxs("div",{className:"flex p-1 bg-gray-900 rounded-lg mb-6 border border-gray-700",children:[e.jsx("button",{onClick:()=>n("CLASSIC"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${t==="CLASSIC"?"bg-blue-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"CLASSIC DCA"}),e.jsx("button",{onClick:()=>n("RANGE"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${t==="RANGE"?"bg-purple-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"RANGE DCA"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 mb-2 block",children:"1. Chọn Coin"}),e.jsx("div",{className:"h-32 overflow-y-auto pr-1 grid grid-cols-3 sm:grid-cols-4 gap-2 border border-gray-700/50 rounded-lg p-2 bg-gray-900/30",children:us.map(j=>e.jsx("button",{onClick:()=>d(j.id),className:`p-2 rounded text-[10px] font-bold border ${h===j.id?"bg-accent-yellow text-gray-900 border-accent-yellow":"bg-gray-700 text-gray-300 border-transparent"}`,children:j.id},j.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 mb-1 block",children:"Vốn (USDT)"}),e.jsx("input",{type:"number",value:c,onChange:j=>a(Number(j.target.value)),className:"w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white text-lg outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 mb-1 block",children:"Đòn bẩy (x)"}),e.jsx("input",{type:"number",value:y,onChange:j=>u(Number(j.target.value)),className:"w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white text-lg text-center outline-none"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx("button",{onClick:()=>N("LONG"),className:`py-3 rounded-lg font-bold transition-all ${i==="LONG"?"bg-green-600 text-white ring-2 ring-green-400":"bg-gray-700 text-gray-400"}`,children:"LONG ↗"}),e.jsx("button",{onClick:()=>N("SHORT"),className:`py-3 rounded-lg font-bold transition-all ${i==="SHORT"?"bg-red-600 text-white ring-2 ring-red-400":"bg-gray-700 text-gray-400"}`,children:"SHORT ↘"})]}),t==="CLASSIC"?e.jsx("div",{className:"bg-gray-700/20 p-3 rounded border border-gray-600 space-y-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs text-gray-300",children:"Số lệnh DCA (Martingale)"}),e.jsx("input",{type:"number",value:v,onChange:j=>E(Number(j.target.value)),className:"w-16 bg-gray-800 border border-gray-600 rounded p-1 text-center text-white text-sm"})]})}):e.jsxs("div",{className:"bg-purple-900/10 p-3 rounded border border-purple-800/50 space-y-4",children:[e.jsx("p",{className:"text-xs font-bold text-purple-300 uppercase",children:"Cấu hình vùng giá"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"Giá Min"}),e.jsx("input",{type:"number",value:D,onChange:j=>k(j.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-sm font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"Giá Max"}),e.jsx("input",{type:"number",value:A,onChange:j=>w(j.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-sm font-mono"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"Số lệnh (Grid)"}),e.jsx("input",{type:"number",value:x,onChange:j=>C(Number(j.target.value)),className:"w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-center text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"Hệ số nhân Vol"}),e.jsx("input",{type:"number",value:b,onChange:j=>L(Number(j.target.value)),step:"0.1",className:"w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-center text-sm"})]})]}),e.jsx("p",{className:"text-[10px] text-gray-400 italic mt-1",children:"Hệ số nhân: 1 = Đều volume. 2 = Gấp đôi volume lệnh sau. Tăng hệ số nhân giúp kéo giá TB về gần giá cuối để an toàn hơn."})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Giá hiện tại:"}),e.jsxs("span",{className:`font-mono font-bold flex items-center gap-2 ${m?"text-gray-500 animate-pulse":"text-white"}`,children:[m&&e.jsx(qe,{className:"animate-spin text-xs"}),o?M(o):"Loading..."]})]}),e.jsxs("button",{onClick:G,disabled:!o||m,className:`w-full py-3.5 font-bold rounded-lg shadow-lg active:scale-95 transition-all disabled:opacity-50 uppercase tracking-wide ${t==="CLASSIC"?"bg-blue-600 hover:bg-blue-500 text-white":"bg-purple-600 hover:bg-purple-500 text-white"}`,children:["TÍNH TOÁN ",t]})]})]})]}),e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:`bg-gray-800 border rounded-xl p-4 sm:p-6 shadow-lg flex flex-col ${t==="RANGE"?"border-purple-900/50":"border-gray-700"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b border-gray-700 pb-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Kết quả phân tích"}),f&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:`text-xs px-2 py-1 rounded font-bold ${i==="LONG"?"bg-green-900 text-green-400":"bg-red-900 text-red-400"}`,children:[i," ",h," x",y]}),!f.isSafeRange&&t==="RANGE"&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded font-bold bg-red-600 text-white flex items-center gap-1 animate-pulse",children:[e.jsx(xt,{})," RỦI RO CAO"]})]})]}),f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-gray-700/40 p-3 rounded-lg border border-gray-600/50 flex flex-col justify-center",children:[e.jsx("span",{className:"text-xs text-gray-400 uppercase mb-1",children:"Giá TB (Avg)"}),e.jsx("span",{className:"text-lg font-mono font-bold text-white",children:M(f.avgPrice)})]}),e.jsxs("div",{className:"bg-gray-700/40 p-3 rounded-lg border border-gray-600/50 flex flex-col justify-center",children:[e.jsx("span",{className:"text-xs text-gray-400 uppercase mb-1",children:"Tổng Ký quỹ"}),e.jsx("span",{className:"text-lg font-mono font-bold text-white",children:z(f.totalMargin)})]}),e.jsxs("div",{className:`p-3 rounded-lg border flex flex-col justify-center sm:col-span-2 ${f.isSafeRange?"bg-gray-700/40 border-gray-600/50":"bg-red-900/20 border-red-600"}`,children:[e.jsxs("span",{className:"text-xs text-gray-400 uppercase mb-1 flex justify-between",children:[e.jsx("span",{children:"Giá Thanh Lý"}),!f.isSafeRange&&e.jsx("span",{className:"text-red-400 font-bold",children:"NẰM TRONG VÙNG DCA!"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-red-400 mr-1",children:"Liq:"}),f.isRekt?e.jsx("span",{className:"text-red-500 font-bold",children:"THIẾU VỐN"}):e.jsx("span",{className:"text-lg font-mono font-bold text-red-400",children:M(f.liquidationPrice||0)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-accent-yellow mr-1",children:"SL:"}),e.jsx("span",{className:"text-lg font-mono font-bold text-accent-yellow",children:f.suggestedSL?M(f.suggestedSL):"---"})]})]})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-gray-700 bg-gray-800 mb-6",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-700/50",children:e.jsxs("tr",{className:"text-gray-400 text-xs uppercase",children:[e.jsx("th",{className:"py-3 px-4",children:"Lệnh"}),e.jsx("th",{className:"py-3 px-4",children:"Giá Entry"}),e.jsx("th",{className:"py-3 px-4",children:"Khoảng cách"}),e.jsx("th",{className:"py-3 px-4",children:"Volume (USDT)"}),e.jsx("th",{className:"py-3 px-4",children:"Margin"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-700",children:f.plans.map((j,O)=>e.jsxs("tr",{className:"hover:bg-gray-700/30 transition-colors",children:[e.jsxs("td",{className:"py-3 px-4 font-bold text-accent-yellow",children:["#",j.level]}),e.jsx("td",{className:`py-3 px-4 font-mono ${i==="LONG"?"text-green-400":"text-red-400"}`,children:M(j.price)}),e.jsx("td",{className:"py-3 px-4 text-gray-400",children:O===0&&t==="CLASSIC"?"Gốc":`${(Math.abs((j.price-(t==="CLASSIC"?f.plans[0].price:o||0))/(t==="CLASSIC"?f.plans[0].price:o||1))*100).toFixed(2)}%`}),e.jsx("td",{className:"py-3 px-4 text-white font-mono",children:z(j.volume)}),e.jsx("td",{className:"py-3 px-4 font-mono text-gray-300",children:z(j.volume/y)})]},j.level))}),e.jsx("tfoot",{className:"bg-gray-700/20 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"py-3 px-4 text-right text-white",children:"TỔNG:"}),e.jsx("td",{className:"py-3 px-4 text-white",children:z(f.totalVolume)}),e.jsx("td",{className:"py-3 px-4 text-accent-yellow",children:z(f.totalMargin)})]})})]})}),e.jsx("div",{className:"md:hidden space-y-2 mb-6",children:f.plans.map(j=>e.jsxs("div",{className:"bg-gray-700/20 border border-gray-700 rounded-lg p-3 text-xs",children:[e.jsxs("div",{className:"flex justify-between font-bold mb-1",children:[e.jsxs("span",{className:"text-accent-yellow",children:["#",j.level]}),e.jsx("span",{className:i==="LONG"?"text-green-400":"text-red-400",children:M(j.price)})]}),e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsxs("span",{children:["Vol: ",z(j.volume)]}),e.jsxs("span",{children:["Mar: ",z(j.volume/y)]})]})]},j.level))}),!f.isSafeRange&&t==="RANGE"&&e.jsxs("div",{className:"p-4 bg-red-900/20 border border-red-800 rounded-lg text-sm text-red-200 flex gap-3 items-start animate-pulse",children:[e.jsx(mt,{className:"text-xl flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"CẢNH BÁO NGUY HIỂM:"}),e.jsx("br",{}),"Giá thanh lý ",M(f.liquidationPrice||0)," nằm trong khoảng giá DCA ",M(parseFloat(D))," - ",M(parseFloat(A)),".",e.jsx("br",{}),"👉 ",e.jsx("strong",{children:"Giải pháp:"})," Tăng hệ số nhân Volume (Multiplier) hoặc Giảm Đòn bẩy."]})]})]}):e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-gray-500 border-2 border-dashed border-gray-700 rounded-xl min-h-[300px] bg-gray-800/50",children:[e.jsx(Je,{className:"text-4xl mb-3 opacity-50"}),e.jsx("p",{children:'Chọn chế độ và nhấn "Tính toán"'})]})]})})]})]})}const ue=$.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});ue.interceptors.request.use(t=>{const n=localStorage.getItem("token");return n&&(t.headers.Authorization=`Bearer ${n}`),t},t=>Promise.reject(t));ue.interceptors.response.use(t=>t,t=>{var n;return((n=t.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(t)});const hs=t=>ue.post("/dca/demo/plan",t),ps=t=>ue.get(`/dca/demo/plans/${t}`),bs=t=>ue.post(`/dca/demo/plan/${t}/toggle`),fs=t=>ue.delete(`/dca/demo/plan/${t}`),ys=t=>e.jsx(Xe,{...t}),js=t=>e.jsx(ft,{...t}),Pe=t=>e.jsx(ht,{...t}),be=t=>e.jsx(gt,{...t}),Ns=t=>e.jsx(pt,{...t}),ze=t=>e.jsx(Je,{...t}),vs=t=>e.jsx(yt,{...t}),He=t=>e.jsx(bt,{...t}),ws=t=>e.jsx(Ve,{...t}),Ss=t=>e.jsx(_e,{...t}),Cs=t=>e.jsx(Ye,{...t}),ks=t=>e.jsx(jt,{...t}),We=t=>e.jsx(Nt,{...t}),Ls=t=>e.jsx(St,{...t}),Ds=t=>e.jsx(wt,{...t}),As=t=>e.jsx(vt,{...t}),Ee=[{id:"custom",name:"-- Nhập tay (Custom) --",apiKey:"",secretKey:"",balance:0},{id:"user_01",name:"Nguyễn Văn A (Main)",apiKey:"vmPUZE6mv9sd...",secretKey:"NhqPtMdSJ...",balance:2450.5},{id:"user_02",name:"Invest Fund (Sub)",apiKey:"AbCxE6mv9sd...",secretKey:"XyZPtMdS...",balance:15e3}],Ts=[{id:"BTC",name:"Bitcoin"},{id:"ETH",name:"Ethereum"},{id:"BNB",name:"Binance Coin"},{id:"SOL",name:"Solana"},{id:"XRP",name:"Ripple"},{id:"ADA",name:"Cardano"},{id:"DOGE",name:"Dogecoin"},{id:"DOT",name:"Polkadot"},{id:"MATIC",name:"Polygon"},{id:"LTC",name:"Litecoin"}],Ps=Array.from({length:24},(t,n)=>n),Es=[{val:1,label:"Thứ 2"},{val:2,label:"Thứ 3"},{val:3,label:"Thứ 4"},{val:4,label:"Thứ 5"},{val:5,label:"Thứ 6"},{val:6,label:"Thứ 7"},{val:0,label:"Chủ Nhật"}],Fs=Array.from({length:28},(t,n)=>n+1);function Is(){const[t,n]=ut(),h=t.get("tab")||"REAL",[d,o]=s.useState(h);s.useEffect(()=>{const r=t.get("tab")||"REAL";(r==="REAL"||r==="BACKTEST"||r==="DEMO")&&o(r)},[t]);const[p,m]=s.useState("BTC"),[l,c]=s.useState(100),[a,y]=s.useState("WEEKLY"),[u,i]=s.useState(1),[N,v]=s.useState(7),[E,D]=s.useState(1),[k,A]=s.useState(1),[w,x]=s.useState("custom"),[C,b]=s.useState(""),[L,f]=s.useState(""),[T,M]=s.useState(!1),[z,G]=s.useState(0),[j,O]=s.useState([]),[W,ee]=s.useState(!1),[Y,te]=s.useState(0),[H,_]=s.useState(null),[J,ie]=s.useState(null),[Z,oe]=s.useState([]),[fe,de]=s.useState(!1),U=s.useRef(null),g=s.useRef(null),S=s.useCallback(async()=>{const r=localStorage.getItem("userId")||"default_user";de(!0);try{const P=await ps(r);oe(P.data)}catch(P){console.error("Failed to fetch demo plans:",P)}finally{de(!1)}},[]),I=async()=>{const r=localStorage.getItem("userId")||"default_user",P=localStorage.getItem("username")||"User",R={userId:r,username:P,symbol:p,amountUSD:l,side:"BUY",recurrence:a,targetHour:N,targetWeekday:a==="WEEKLY"?E:void 0,targetDate:a==="MONTHLY"?k:void 0,active:!0,totalInvested:0,currentValue:0,totalCoins:0};try{await hs(R),await S(),alert("✅ Đã tạo Demo Plan thành công!")}catch(B){console.error("Failed to create demo plan:",B),alert("❌ Lỗi tạo plan")}},se=async r=>{try{await bs(r),await S()}catch(P){console.error("Failed to toggle plan:",P)}},V=async r=>{if(confirm("Bạn có chắc muốn xóa plan này?"))try{await fs(r),await S()}catch(P){console.error("Failed to delete plan:",P)}};s.useEffect(()=>{d==="DEMO"&&S()},[d,S]);const xe=r=>{const P=r.target.value;x(P);const R=Ee.find(B=>B.id===P);R?(b(R.apiKey),f(R.secretKey),G(R.balance)):(b(""),f(""),G(0))},ge=()=>{var R;let r="";a==="DAILY"&&(r=`${N}:00 hàng ngày`),a==="WEEKLY"&&(r=`Thứ ${E===0?"CN":E+1}, ${N}:00`),a==="MONTHLY"&&(r=`Ngày ${k}, ${N}:00`);const P={id:Date.now(),symbol:p,amount:l,frequency:a,detailTime:r,nextRun:"2025-02-01 07:00",status:"RUNNING",accountName:((R=Ee.find(B=>B.id===w))==null?void 0:R.name)||"Custom Key",totalInvested:0,currentValue:0,transactions:[]};if(!C)return alert("Vui lòng chọn tài khoản hoặc nhập API Key!");if(z<l)return alert("Số dư thực tế không đủ!");O([P,...j]),alert("✅ Đã kích hoạt Plan Real thành công!")},he=r=>{const P=95e3+Math.random()*2e3,R={id:Date.now(),date:new Date().toLocaleString(),price:P,amountUsdt:l,amountCoin:l/P,status:"SUCCESS"};if(z<l)return alert("Số dư không đủ!");G(B=>B-l),O(B=>B.map(K=>K.id===r?{...K,totalInvested:K.totalInvested+l,currentValue:K.currentValue+l,transactions:[R,...K.transactions]}:K))},q=async(r,P,R)=>{let B=[],K=P;const ce="1h",re=1e3,De=R-P;let ye=0;const je=200;for(;K<R&&ye<je;){ye++;try{const ne=(await $.get("https://api.binance.com/api/v3/klines",{params:{symbol:`${r}USDT`,interval:ce,startTime:K,endTime:R,limit:re}})).data;if(!ne||ne.length===0)break;B=[...B,...ne],K=ne[ne.length-1][0]+1,te(Math.min(99,Math.floor((ne[ne.length-1][0]-P)/De*100))),await new Promise(le=>setTimeout(le,20))}catch{break}}return te(100),B},F=async()=>{ee(!0),te(0),_(null);try{const r=new Date,P=new Date;P.setFullYear(P.getFullYear()-u);const R=await q(p,P.getTime(),r.getTime());if(!R||R.length===0){alert("Không có dữ liệu lịch sử."),ee(!1);return}let B=0,K=0,ce=0;const re=new Map;for(let le=0;le<R.length;le++){const Ae=R[le][0],st=parseFloat(R[le][1]),rt=parseFloat(R[le][4]),ve=new Date(Ae),at=ve.getHours(),nt=ve.getDay(),lt=ve.getDate(),Oe=ve.toISOString().split("T")[0];let we=!1;at===N&&(a==="DAILY"||a==="WEEKLY"&&nt===E||a==="MONTHLY"&&lt===k)&&(we=!0),we&&(B+=l/st,K+=l,ce++),K>0&&re.set(Oe,{time:Oe,value:B*rt,invested:K})}const De=Array.from(re.values()).sort((le,Ae)=>new Date(le.time).getTime()-new Date(Ae.time).getTime()),ye=parseFloat(R[R.length-1][4]),je=B*ye,Ne=je-K,ne=K>0?Ne/K*100:0;_({symbol:p,totalInvested:K,currentValue:je,totalCoins:B,pnl:Ne,roe:ne,avgPrice:K>0?K/B:0,buyCount:ce,history:De})}catch(r){console.error(r),alert("Lỗi tính toán.")}finally{ee(!1)}};s.useEffect(()=>{if(d!=="BACKTEST"||!H||!U.current)return;g.current&&(g.current.remove(),g.current=null);const r=Fe(U.current,{layout:{background:{type:Ie.Solid,color:"transparent"},textColor:"#9CA3AF"},grid:{vertLines:{color:"#374151"},horzLines:{color:"#374151"}},width:U.current.clientWidth,height:300,rightPriceScale:{borderVisible:!1},timeScale:{borderVisible:!1,timeVisible:!0}}),P=r.addLineSeries({color:"#22c55e",lineWidth:2}),R=r.addLineSeries({color:"#fbbf24",lineWidth:2,lineStyle:2}),B=H.history.map(re=>({time:re.time,value:re.value})),K=H.history.map(re=>({time:re.time,value:re.invested}));B.length>0&&(P.setData(B),R.setData(K),r.timeScale().fitContent()),g.current=r;const ce=()=>{U.current&&g.current&&g.current.applyOptions({width:U.current.clientWidth})};return window.addEventListener("resize",ce),()=>{window.removeEventListener("resize",ce),g.current&&(g.current.remove(),g.current=null)}},[H,d]);const Q=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}).format(r);return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-gray-100 pb-20 md:p-6 md:pb-6",children:[e.jsxs("div",{className:"p-4 bg-gray-900 border-b border-gray-800 md:border-none md:bg-transparent md:p-0 flex flex-row items-center gap-4 mb-0 md:mb-6 sticky top-0 z-40",children:[e.jsx(me,{to:"/",className:"flex items-center justify-center w-10 h-10 rounded-full bg-gray-800 hover:bg-gray-700 transition text-gray-300 hover:text-white border border-gray-700",children:e.jsx(ys,{})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg md:text-3xl font-bold text-white flex items-center gap-2",children:[e.jsx(be,{className:"text-accent-yellow"})," ",e.jsx("span",{children:"DCA Master"})]}),e.jsx("p",{className:"text-gray-500 text-xs md:text-sm",children:"Tích sản Tự động"})]})]}),e.jsx("div",{className:"px-4 md:px-0 mb-6",children:e.jsx("div",{className:"flex gap-2 bg-gray-900/50 p-1 rounded-lg md:bg-transparent md:p-0",children:[{key:"REAL",label:" Real",icon:"money"},{key:"DEMO",label:" Demo",icon:"robot"},{key:"BACKTEST",label:" Backtest",icon:"chart"}].map(r=>e.jsxs("button",{onClick:()=>{o(r.key),n({tab:r.key})},className:`flex-1 md:flex-none px-4 py-3 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${d===r.key?"bg-blue-600 text-white shadow-lg":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[r.icon==="money"&&e.jsx("span",{children:e.jsx(Pe,{})}),r.icon==="robot"&&e.jsx("span",{children:e.jsx(be,{})}),r.icon==="chart"&&e.jsx("span",{children:e.jsx(ze,{})}),r.label]},r.key))})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-0 md:gap-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"lg:col-span-1 bg-gray-900 md:bg-gray-800 border-b md:border border-gray-800 md:rounded-xl p-5 md:p-6 shadow-none md:shadow-lg h-fit",children:[e.jsxs("h2",{className:"text-base font-bold mb-5 text-white flex items-center gap-2 pb-3 border-b border-gray-800",children:[e.jsx(Ns,{className:"text-accent-yellow"})," Cấu hình ",d==="REAL"?"Đầu tư":"Kiểm thử"]}),e.jsxs("div",{className:"space-y-5",children:[d==="REAL"&&e.jsxs("div",{className:"bg-green-900/10 border border-green-800/50 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-green-400 text-[10px] font-bold uppercase tracking-wider",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ws,{})," Tài khoản"]}),e.jsx("span",{className:C?"text-green-400":"text-gray-500",children:C?"● Connected":"○ No Key"})]}),e.jsx("select",{value:w,onChange:xe,className:"w-full bg-gray-950 border border-gray-700 rounded-lg px-3 py-2.5 text-sm text-white outline-none",children:Ee.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))}),w==="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"API Key",value:C,onChange:r=>b(r.target.value),className:"w-full bg-gray-950 border border-gray-700 rounded px-3 py-2 text-xs text-white"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:T?"text":"password",placeholder:"Secret Key",value:L,onChange:r=>f(r.target.value),className:"w-full bg-gray-950 border border-gray-700 rounded px-3 py-2 text-xs text-white pr-8"}),e.jsx("button",{className:"absolute right-2 top-2 text-gray-400",onClick:()=>M(!T),children:T?e.jsx(Cs,{}):e.jsx(Ss,{})})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-green-800/20",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Số dư khả dụng"}),e.jsx("span",{className:"text-lg font-bold text-white",children:Q(z)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500 mb-1.5 block",children:"Chọn Coin"}),e.jsx("select",{value:p,onChange:r=>m(r.target.value),className:"w-full bg-gray-950 border border-gray-700 rounded-lg p-3 text-white outline-none text-sm font-bold",children:Ts.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500 mb-1.5 block",children:"Số tiền (USDT)"}),e.jsx("input",{type:"number",inputMode:"decimal",value:l,onChange:r=>c(Number(r.target.value)),className:"w-full bg-gray-950 border border-gray-700 rounded-lg p-3 text-white outline-none text-sm font-bold font-mono"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500 mb-1.5 block",children:"Tần suất mua"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["DAILY","WEEKLY","MONTHLY"].map(r=>e.jsx("button",{onClick:()=>y(r),className:`py-2.5 rounded-lg text-[10px] sm:text-xs font-bold transition-all border ${a===r?"bg-blue-600 border-blue-500 text-white shadow-md":"bg-gray-950 border-gray-700 text-gray-400"}`,children:r==="DAILY"?"Hàng Ngày":r==="WEEKLY"?"Hàng Tuần":"Hàng Tháng"},r))})]}),e.jsxs("div",{className:"bg-gray-950/50 p-3 rounded-lg border border-gray-800 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-300 font-bold",children:[e.jsx(He,{className:"text-accent-yellow"})," Thời điểm khớp lệnh"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{children:e.jsx("select",{value:N,onChange:r=>v(Number(r.target.value)),className:"w-full bg-gray-900 border border-gray-700 rounded p-2 text-xs text-white outline-none",children:Ps.map(r=>e.jsxs("option",{value:r,children:[r,":00"]},r))})}),a!=="DAILY"&&e.jsx("div",{children:e.jsx("select",{value:a==="WEEKLY"?E:k,onChange:r=>a==="WEEKLY"?D(Number(r.target.value)):A(Number(r.target.value)),className:"w-full bg-gray-900 border border-gray-700 rounded p-2 text-xs text-white outline-none",children:a==="WEEKLY"?Es.map(r=>e.jsx("option",{value:r.val,children:r.label},r.val)):Fs.map(r=>e.jsxs("option",{value:r,children:["Ngày ",r]},r))})})]})]}),d==="BACKTEST"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500 mb-1.5 block",children:"Dữ liệu quá khứ"}),e.jsxs("select",{value:u,onChange:r=>i(Number(r.target.value)),className:"w-full bg-gray-950 border border-gray-700 rounded-lg p-3 text-white outline-none text-sm",children:[e.jsx("option",{value:"1",children:"1 Năm qua"}),e.jsx("option",{value:"3",children:"3 Năm qua"}),e.jsx("option",{value:"5",children:"5 Năm qua"}),e.jsx("option",{value:"10",children:"10 Năm qua"})]})]}),e.jsx("div",{className:"pt-2 pb-4 md:pb-0",children:d==="BACKTEST"?e.jsxs("button",{onClick:F,disabled:W,className:"w-full py-4 bg-accent-yellow hover:bg-yellow-500 text-gray-900 font-bold rounded-xl shadow-lg active:scale-95 transition disabled:opacity-50 flex items-center justify-center gap-2 uppercase tracking-wide text-sm",children:[W?e.jsx("span",{className:"animate-spin",children:"↻"}):e.jsx(js,{}),W?`Loading ${Y}%`:"CHẠY BACKTEST"]}):e.jsxs("button",{onClick:ge,className:"w-full py-4 font-bold rounded-xl shadow-lg active:scale-95 transition flex items-center justify-center gap-2 text-sm uppercase tracking-wide bg-green-600 hover:bg-green-500 text-white",children:[e.jsx(vs,{})," KÍCH HOẠT LỆNH THẬT"]})})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 px-0 md:px-0",children:[d==="REAL"&&e.jsxs("div",{className:"bg-gray-900 md:bg-gray-800 md:border border-gray-800 md:rounded-xl p-4 md:p-6 shadow-none md:shadow-lg min-h-[400px]",children:[e.jsx("div",{className:"flex justify-between items-center mb-6 px-2 md:px-0",children:e.jsxs("h2",{className:"text-lg md:text-xl font-bold flex items-center gap-2 text-green-400",children:[e.jsx(Pe,{})," Danh sách Plan REAL"]})}),e.jsxs("div",{className:"space-y-3",children:[j.map(r=>e.jsxs("div",{className:"bg-gray-800 md:bg-gray-700/20 border border-gray-700 md:border-gray-600 rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-sm bg-green-900 text-green-400",children:r.symbol.substring(0,3)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-white",children:r.symbol}),e.jsx("span",{className:"text-[10px] bg-gray-700 text-gray-300 px-1.5 py-0.5 rounded",children:r.frequency})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[e.jsxs("span",{className:"text-white font-bold",children:[r.amount,"$"]})," / lần"]})]})]}),e.jsxs("button",{onClick:()=>ie(J===r.id?null:r.id),className:"text-xs bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded-lg flex items-center gap-1 border border-gray-600 transition",children:[e.jsx(ks,{})," Chi tiết"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-700/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Đã đầu tư"}),e.jsx("p",{className:"text-sm text-white font-bold font-mono",children:Q(r.totalInvested)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he(r.id),className:"text-[10px] bg-gray-800 border border-gray-600 px-3 py-1.5 rounded-full text-gray-300 hover:text-white hover:bg-gray-700 transition",children:"Test"}),e.jsx("button",{className:"text-[10px] bg-red-900/20 border border-red-800 px-3 py-1.5 rounded-full text-red-400 hover:bg-red-900/40",children:e.jsx(We,{})})]})]})]}),J===r.id&&e.jsxs("div",{className:"bg-gray-950/50 border-t border-gray-700 p-4 animate-fadeIn",children:[e.jsxs("h4",{className:"text-xs font-bold text-gray-400 uppercase mb-2 flex justify-between",children:[e.jsx("span",{children:"Lịch sử giao dịch"}),e.jsx("span",{className:"text-gray-500 truncate max-w-[150px]",children:r.accountName})]}),r.transactions.length===0?e.jsx("p",{className:"text-center text-xs text-gray-500 italic py-4 border border-dashed border-gray-800 rounded",children:"Chưa có giao dịch nào."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-xs whitespace-nowrap",children:[e.jsx("thead",{className:"text-gray-500 border-b border-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pl-2",children:"Time"}),e.jsx("th",{className:"py-2",children:"Price"}),e.jsx("th",{className:"py-2",children:"Amount"}),e.jsx("th",{className:"py-2 text-right pr-2",children:"Total"})]})}),e.jsx("tbody",{className:"text-gray-300 divide-y divide-gray-800",children:r.transactions.map(P=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 pl-2 text-gray-500",children:P.date.split(",")[1]}),e.jsxs("td",{className:"py-2 font-mono text-accent-yellow",children:["$",P.price.toFixed(0)]}),e.jsx("td",{className:"py-2 font-mono",children:P.amountCoin.toFixed(5)}),e.jsx("td",{className:"py-2 font-mono font-bold text-right pr-2",children:Q(P.amountUsdt)})]},P.id))})]})})]})]},r.id)),j.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-900/50 rounded-xl border-2 border-dashed border-gray-700 mx-4 md:mx-0",children:[e.jsx(be,{className:"text-4xl text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Chưa có kế hoạch nào."})]})]})]}),d==="DEMO"&&e.jsxs("div",{className:"bg-gray-900 md:bg-gray-800 md:border border-gray-800 md:rounded-xl p-4 md:p-6 shadow-none md:shadow-lg min-h-[400px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 px-2 md:px-0",children:[e.jsxs("h2",{className:"text-lg md:text-xl font-bold flex items-center gap-2 text-purple-400",children:[e.jsx(be,{})," Danh sách Demo Plans"]}),e.jsxs("button",{onClick:I,className:"bg-purple-600 hover:bg-purple-500 text-white text-xs px-3 py-2 rounded-lg font-bold flex items-center gap-1",children:[e.jsx(As,{})," Tạo Plan"]})]}),fe?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Đang tải..."})]}):e.jsxs("div",{className:"space-y-3",children:[Z.map(r=>{var P,R;return e.jsx("div",{className:"bg-gray-800 md:bg-gray-700/20 border border-gray-700 md:border-gray-600 rounded-xl overflow-hidden shadow-sm",children:e.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-sm bg-purple-900 text-purple-400",children:(P=r.symbol)==null?void 0:P.substring(0,3)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-white",children:r.symbol}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${r.active?"bg-green-900/50 text-green-400":"bg-gray-700 text-gray-400"}`,children:r.active?"● Active":"○ Paused"})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[e.jsxs("span",{className:"text-white font-bold",children:[r.amountUSD,"$"]})," / ",(R=r.recurrence)==null?void 0:R.toLowerCase()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r.id&&se(r.id),className:`p-2 rounded-lg transition ${r.active?"bg-yellow-900/30 text-yellow-400 hover:bg-yellow-900/50":"bg-green-900/30 text-green-400 hover:bg-green-900/50"}`,title:r.active?"Pause":"Resume",children:r.active?e.jsx(Ds,{}):e.jsx(Ls,{})}),e.jsx("button",{onClick:()=>r.id&&V(r.id),className:"p-2 bg-red-900/20 text-red-400 hover:bg-red-900/40 rounded-lg transition",title:"Delete",children:e.jsx(We,{})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-3 border-t border-gray-700/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Đã đầu tư"}),e.jsx("p",{className:"text-sm text-white font-bold font-mono",children:Q(r.totalInvested||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Giá trị"}),e.jsx("p",{className:"text-sm text-white font-bold font-mono",children:Q(r.currentValue||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Coins"}),e.jsx("p",{className:"text-sm text-accent-yellow font-bold font-mono",children:(r.totalCoins||0).toFixed(4)})]})]}),r.nextRun&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(He,{className:"text-accent-yellow"}),e.jsxs("span",{children:["Lần chạy tiếp: ",new Date(r.nextRun).toLocaleString("vi-VN")]})]})]})},r.id)}),Z.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-900/50 rounded-xl border-2 border-dashed border-gray-700 mx-4 md:mx-0",children:[e.jsx(be,{className:"text-4xl text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Chưa có Demo Plan nào."}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:'Nhấn "Tạo Plan" để bắt đầu'})]})]})]}),d==="BACKTEST"&&e.jsxs("div",{className:"bg-gray-900 md:bg-gray-800 border-y md:border border-gray-800 md:rounded-xl p-4 md:p-6 shadow-none md:shadow-lg h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 px-2 md:px-0",children:[e.jsxs("h2",{className:"text-lg md:text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ze,{className:"text-blue-400"})," Kết quả Backtest"]}),H&&e.jsxs("span",{className:`text-xs font-bold px-2 py-1 rounded border ${H.roe>=0?"bg-green-900/30 text-green-400 border-green-800":"bg-red-900/30 text-red-400 border-red-800"}`,children:["ROE: ",H.roe>0?"+":"",H.roe.toFixed(2),"%"]})]}),H?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6 px-2 md:px-0",children:[e.jsxs("div",{className:"bg-gray-800 md:bg-gray-700/30 p-3 rounded-lg border border-gray-700 md:border-gray-600/50",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-bold",children:"Tổng Vốn"}),e.jsx("p",{className:"text-lg font-bold text-gray-300",children:Q(H.totalInvested)})]}),e.jsxs("div",{className:"bg-gray-800 md:bg-gray-700/30 p-3 rounded-lg border border-gray-700 md:border-gray-600/50",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-bold",children:"Giá trị hiện tại"}),e.jsx("p",{className:"text-lg font-bold text-white",children:Q(H.currentValue)})]}),e.jsxs("div",{className:"bg-gray-800 md:bg-gray-700/30 p-3 rounded-lg border border-gray-700 md:border-gray-600/50",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-bold",children:"Lãi / Lỗ"}),e.jsxs("p",{className:`text-lg font-bold ${H.pnl>=0?"text-green-400":"text-red-400"}`,children:[H.pnl>=0?"+":"",Q(H.pnl)]})]}),e.jsxs("div",{className:"bg-gray-800 md:bg-gray-700/30 p-3 rounded-lg border border-gray-700 md:border-gray-600/50",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-bold",children:"Giá TB Mua"}),e.jsxs("p",{className:"text-lg font-bold text-accent-yellow",children:["$",H.avgPrice.toLocaleString()]})]})]}),e.jsx("div",{className:"flex-grow bg-gray-950 md:bg-gray-900 border border-gray-800 md:border-gray-700 rounded-lg p-1 relative min-h-[300px] mx-2 md:mx-0",children:e.jsx("div",{ref:U,className:"absolute inset-0 w-full h-full"})})]}):e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-gray-500 min-h-[300px] bg-gray-900/30 rounded-xl border border-dashed border-gray-800 mx-4 md:mx-0",children:[e.jsx(Pe,{className:"text-5xl mb-4 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Chạy Backtest để xem kết quả"}),W&&e.jsx("div",{className:"mt-4 w-1/2 bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:"bg-accent-yellow h-1.5 rounded-full transition-all duration-300",style:{width:`${Y}%`}})})]})]})]})]})]})}function Ms(){return e.jsx(Ct,{children:e.jsx(Tt,{children:e.jsxs(kt,{children:[e.jsx(ae,{path:"/login",element:e.jsx(Bt,{})}),e.jsx(ae,{path:"/register",element:e.jsx(ms,{})}),e.jsxs(ae,{path:"/",element:e.jsx(Pt,{children:e.jsx(Vt,{})}),children:[e.jsx(ae,{index:!0,element:e.jsx(Ge,{to:"/monitor",replace:!0})}),e.jsx(ae,{path:"users",element:e.jsx(Xt,{})}),e.jsx(ae,{path:"history",element:e.jsx(Zt,{})}),e.jsx(ae,{path:"monitor",element:e.jsx(rs,{})}),e.jsx(ae,{path:"monitor/:symbol",element:e.jsx(xs,{})}),e.jsx(ae,{path:"/strategy",element:e.jsx(gs,{})}),e.jsx(ae,{path:"/dca",element:e.jsx(Is,{})})]})]})})})}const tt=document.getElementById("root");if(!tt)throw new Error("Could not find root element to mount to");const Rs=Lt.createRoot(tt);Rs.render(e.jsx(Dt.StrictMode,{children:e.jsx(Ms,{})}));
